(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{9650:function(e,t,r){Promise.resolve().then(r.bind(r,3684))},3684:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var s=r(7437),a=r(2265),n=r(6463),i=r(857),l=r(716),o=r(4208),c=r(4660);function d(e){let{params:t}=e,{user:r}=(0,i.a)(),{profile:c}=(0,l.G)(),d=(0,n.useRouter)(),[u,m]=(0,a.useState)(null),[x,f]=(0,a.useState)(!0),[g,p]=(0,a.useState)(""),[h,b]=(0,a.useState)(!1),[y,v]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(r&&c)return(0,o.subscribeToRoom)(t.roomCode,e=>{if(!e){p("Room not found"),f(!1);return}if(!e.players[r.id]){console.log("User has been kicked from room:",r.id),p("You have been removed from this room"),setTimeout(()=>d.push("/"),2e3);return}m(e),f(!1),("headstart"===e.status||"active"===e.status)&&d.push("/game/".concat(t.roomCode))})},[r,c,t.roomCode,d]);let j=async()=>{if(r)try{await (0,o.leaveRoom)(t.roomCode,r.id),d.push("/")}catch(e){console.error("Error leaving room:",e)}},N=async()=>{if(r&&u){b(!0);try{await (0,o.startGame)(t.roomCode)}catch(e){p(e.message||"Failed to start game"),b(!1)}}},w=async e=>{if(r&&u){v(e);try{await (0,o.kickPlayer)(t.roomCode,r.id,e)}catch(e){p(e.message||"Failed to kick player")}finally{v(null)}}};if(x)return(0,s.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"glass-card p-8 text-center animate-slide-up",children:[(0,s.jsx)("div",{className:"text-xl text-granny-text mb-4 flex items-center justify-center gap-2",children:"\uD83C\uDFE0 Loading room..."}),(0,s.jsx)("div",{className:"w-8 h-8 border-2 border-granny-danger border-t-transparent rounded-full animate-spin mx-auto"})]})});if(g||!u)return(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg pointer-events-none"}),(0,s.jsxs)("div",{className:"glass-card p-8 text-center animate-slide-up relative z-10",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-granny-text mb-4",children:"Room Error"}),(0,s.jsx)("p",{className:"text-granny-error mb-6",children:g||"Room not found"}),(0,s.jsx)("button",{onClick:()=>d.push("/"),className:"btn-primary px-6 py-3",children:"\uD83C\uDFE0 Back to Home"})]})]});let P=Object.values(u.players),D=(null==r?void 0:r.id)===u.host_uid,C=P.length>=2&&P.length>=u.settings.killerCount+1;return(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 max-w-2xl mx-auto relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg pointer-events-none"}),(0,s.jsxs)("div",{className:"w-full glass-modal p-8 text-granny-text animate-slide-up relative z-10",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-granny-text mb-2 flex items-center justify-center gap-2",children:["\uD83C\uDFE0 Room ",u.id]}),(0,s.jsx)("p",{className:"text-granny-text-muted",children:"Share this code with friends to join the hunt"})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-granny-text flex items-center gap-2",children:"⚙️ Game Settings"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"glass-card p-4 border border-granny-border/30 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-granny-danger mb-1",children:u.settings.killerCount}),(0,s.jsx)("div",{className:"text-sm text-granny-text-muted",children:"\uD83D\uDD2A Killers"})]}),(0,s.jsxs)("div",{className:"glass-card p-4 border border-granny-border/30 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-granny-warning mb-1",children:u.settings.roundLengthMinutes}),(0,s.jsx)("div",{className:"text-sm text-granny-text-muted",children:"⏱️ Round (min)"})]}),(0,s.jsxs)("div",{className:"glass-card p-4 border border-granny-border/30 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-granny-survivor mb-1",children:u.settings.headstartMinutes}),(0,s.jsx)("div",{className:"text-sm text-granny-text-muted",children:"\uD83C\uDFC3 Headstart (min)"})]}),(0,s.jsxs)("div",{className:"glass-card p-4 border border-granny-border/30 text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-granny-text mb-1",children:u.settings.maxPlayers}),(0,s.jsx)("div",{className:"text-sm text-granny-text-muted",children:"\uD83D\uDC65 Max Players"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold mb-4 text-granny-text flex items-center gap-2",children:["\uD83D\uDC65 Players (",P.length,"/",u.settings.maxPlayers,")"]}),(0,s.jsx)("div",{className:"space-y-3",children:P.map(e=>{var t;return(0,s.jsx)("div",{className:"glass-card p-4 border border-granny-border/30 hover:border-granny-border/50 transition-all duration-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[e.profilePictureUrl?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:e.profilePictureUrl,alt:e.displayName,className:"w-12 h-12 rounded-full object-cover border-2 border-granny-survivor/50"}),e.uid===u.host_uid&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-granny-warning rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs",children:"\uD83D\uDC51"})})]}):(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-granny-surface border-2 border-granny-border/50 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-lg font-bold text-granny-text",children:null===(t=e.displayName[0])||void 0===t?void 0:t.toUpperCase()})}),e.uid===u.host_uid&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-granny-warning rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs",children:"\uD83D\uDC51"})})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-semibold text-granny-text",children:e.displayName}),e.uid===u.host_uid&&(0,s.jsx)("p",{className:"text-xs text-granny-warning font-medium",children:"\uD83D\uDC51 Host"})]}),D&&e.uid!==u.host_uid&&(0,s.jsx)("button",{onClick:()=>w(e.uid),disabled:y===e.uid,className:"px-3 py-1 text-xs bg-granny-error hover:bg-granny-error/80 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:y===e.uid?"⏳ Kicking...":"\uD83D\uDEAB Kick"})]})},e.uid)})})]}),g&&(0,s.jsx)("div",{className:"mb-6 glass-card p-4 border border-granny-error/30 bg-granny-error/10",children:(0,s.jsxs)("p",{className:"text-granny-error text-sm font-medium flex items-center gap-2",children:["⚠️ ",g]})}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:j,className:"btn-ghost flex-1 py-3",children:"\uD83D\uDEAA Leave Room"}),D&&(0,s.jsx)("button",{onClick:N,disabled:!C||h,className:"btn-primary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",children:h?(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,s.jsx)("span",{children:"Starting..."})]}):(0,s.jsx)(s.Fragment,{children:"\uD83C\uDFAE Start Game"})})]}),!C&&D&&(0,s.jsxs)("p",{className:"text-center text-sm text-granny-text-muted mt-4 flex items-center justify-center gap-1",children:["⚠️ Need at least ",Math.max(2,u.settings.killerCount+1)," players to start"]})]})]})}function u(e){let{params:t}=e;return(0,s.jsx)(c.Z,{fallback:(0,s.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg pointer-events-none"}),(0,s.jsxs)("div",{className:"glass-card p-8 text-center animate-slide-up relative z-10",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD12"}),(0,s.jsx)("p",{className:"text-granny-text text-lg mb-4",children:"Please sign in to access this room"}),(0,s.jsx)("p",{className:"text-granny-text-muted text-sm",children:"Join the hunt with other players"})]})]}),children:(0,s.jsx)(d,{params:t})})}},716:function(e,t,r){"use strict";r.d(t,{G:function(){return i}});var s=r(2265),a=r(857),n=r(5347);function i(){let{user:e}=(0,a.a)(),[t,r]=(0,s.useState)(null),[i,l]=(0,s.useState)(!0),[o,c]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!e){r(null),l(!1);return}(async()=>{try{console.log("useUserProfile: Loading profile for user:",e.id),console.log("useUserProfile: User metadata:",e.user_metadata);let t=await (0,n.et)(e.id);console.log("useUserProfile: Existing profile found:",t),t||(console.log("useUserProfile: Creating new profile..."),t=await (0,n.xv)({id:e.id,email:e.email||"",user_metadata:e.user_metadata||{}}),console.log("useUserProfile: New profile created:",t),c(!0)),r(t)}catch(e){console.error("Error loading user profile:",e)}finally{l(!1)}})()},[e]),{profile:t,loading:i,needsSetup:o,setNeedsSetup:c,refreshProfile:async()=>{if(e)try{let t=await (0,n.et)(e.id);r(t)}catch(e){console.error("Error refreshing profile:",e)}}}}},5347:function(e,t,r){"use strict";r.d(t,{Lj:function(){return i},et:function(){return n},ow:function(){return l},sx:function(){return c},xv:function(){return a}});var s=r(6881);async function a(e){var t;let r=e.user_metadata.full_name||e.user_metadata.name||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Anonymous User",a={uid:e.id,email:e.email,display_name:r,created_at:Date.now(),last_active:Date.now()},{error:n}=await s.O.from("user_profiles").upsert(a);if(n)throw n;return a}async function n(e){let{data:t,error:r}=await s.O.from("user_profiles").select("*").eq("uid",e).single();if(r&&"PGRST116"!==r.code)throw r;return t}async function i(e,t){console.log("updateUserProfile: Updating profile for uid:",e,"with updates:",t);let{error:r}=await s.O.from("user_profiles").update({...t,last_active:Date.now()}).eq("uid",e);if(r)throw console.error("updateUserProfile: Error updating profile:",r),r;console.log("updateUserProfile: Profile updated successfully")}async function l(e,t){console.log("uploadProfilePicture: Starting upload for user:",e),await d(e);let r=await o(t),a=t.name.split(".").pop(),n="".concat(e,".").concat(a);console.log("uploadProfilePicture: Uploading file:",n,"Size:",r.size);let{error:l}=await s.O.storage.from("profile-pictures").upload(n,r,{upsert:!0,contentType:r.type});if(l)throw console.error("uploadProfilePicture: Upload error:",l),l;let{data:c}=s.O.storage.from("profile-pictures").getPublicUrl(n);return console.log("uploadProfilePicture: Public URL:",c.publicUrl),await i(e,{profile_picture_url:c.publicUrl}),c.publicUrl}async function o(e){return e.size<1e5?e:new Promise(t=>{let r=new FileReader;r.readAsDataURL(e),r.onload=r=>{var s;let a=new Image;a.src=null===(s=r.target)||void 0===s?void 0:s.result,a.onload=()=>{let r=document.createElement("canvas"),s=r.getContext("2d"),n=a.width,i=a.height;n>i&&n>500?(i=500*i/n,n=500):i>500&&(n=500*n/i,i=500),r.width=n,r.height=i,s.drawImage(a,0,0,n,i),r.toBlob(r=>{t(new File([r],e.name,{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",.8)}}})}async function c(e){try{console.log("deleteProfilePicture: Removing profile picture for user:",e),await d(e),await i(e,{profile_picture_url:void 0}),console.log("deleteProfilePicture: Profile picture deleted successfully")}catch(e){throw console.error("Error deleting profile picture:",e),e}}async function d(e){try{var t;console.log("deleteExistingProfilePictures: Cleaning up old pictures for user:",e);let{data:r,error:a}=await s.O.storage.from("profile-pictures").list("",{search:e});if(a){console.log("deleteExistingProfilePictures: Could not list files:",a);let{error:t}=await s.O.storage.from("profile-pictures").remove(["".concat(e,".jpg"),"".concat(e,".jpeg"),"".concat(e,".png"),"".concat(e,".gif"),"".concat(e,".webp"),"".concat(e,".bmp")]);t&&console.log("deleteExistingProfilePictures: Error removing files:",t);return}let n=(null==r?void 0:null===(t=r.filter(t=>t.name.startsWith(e)))||void 0===t?void 0:t.map(e=>e.name))||[];if(n.length>0){console.log("deleteExistingProfilePictures: Found files to delete:",n);let{error:e}=await s.O.storage.from("profile-pictures").remove(n);e?console.error("deleteExistingProfilePictures: Error removing files:",e):console.log("deleteExistingProfilePictures: Successfully deleted files:",n)}else console.log("deleteExistingProfilePictures: No existing files found for user")}catch(e){console.error("deleteExistingProfilePictures: Error:",e)}}}},function(e){e.O(0,[34,712,971,23,744],function(){return e(e.s=9650)}),_N_E=e.O()}]);
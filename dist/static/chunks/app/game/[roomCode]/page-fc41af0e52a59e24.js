(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[785],{5292:function(e,t,s){Promise.resolve().then(s.bind(s,4939))},4939:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return A}});var a=s(7437),r=s(2265),n=s(6463),l=s(857),i=s(716),o=s(4208),c=s(6976),d=s(4660),u=s(6892),m=s(7818);s(966);var x=s(7691),g=s.n(x);let h=(0,m.default)(()=>s.e(376).then(s.bind(s,1376)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),v=(0,m.default)(()=>s.e(376).then(s.bind(s,1376)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),p=(0,m.default)(()=>s.e(376).then(s.bind(s,1376)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),b=(0,m.default)(()=>s.e(376).then(s.bind(s,1376)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),y=(0,m.default)(()=>s.e(376).then(s.bind(s,1376)).then(e=>e.Circle),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),f=e=>{let t=e.isCompleted,s='<div style="\n    width: '.concat(35,"px;\n    height: ").concat(35,"px;\n    border-radius: 50%;\n    border: 3px solid white;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n    background-color: ").concat(t?"#10B981":"#F59E0B",";\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: bold;\n    font-size: ").concat(17.5,"px;\n    ").concat(t?"opacity: 0.7;":"",'\n  ">').concat(t?"✓":"⚡","</div>");return g().divIcon({className:"custom-skillcheck-icon",html:s,iconSize:[35,35],iconAnchor:[17.5,17.5]})},j=()=>{let e='<div style="\n    width: '.concat(45,"px;\n    height: ").concat(45,"px;\n    border-radius: 50%;\n    border: 4px solid white;\n    box-shadow: 0 3px 8px rgba(0,0,0,0.4);\n    background-color: #8B5CF6;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: bold;\n    font-size: ").concat(18,'px;\n    animation: escapeAreaPulse 2s infinite;\n  ">\uD83D\uDEAA</div>\n  <style>\n    @keyframes escapeAreaPulse {\n      0%, 100% { transform: scale(1); box-shadow: 0 3px 8px rgba(0,0,0,0.4); }\n      50% { transform: scale(1.1); box-shadow: 0 4px 12px rgba(139,92,246,0.6); }\n    }\n  </style>');return g().divIcon({className:"custom-escape-area-icon",html:e,iconSize:[45,45],iconAnchor:[22.5,22.5]})},N=function(e){var t;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=s?50:40,r="#3B82F6";"killer"===e.role?r=s?"#DC2626":"#EF4444":e.isAlive||(r="#6B7280");let n=e.profilePictureUrl?'<div style="\n        width: '.concat(a,"px;\n        height: ").concat(a,"px;\n        border-radius: 50%;\n        border: 3px solid white;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n        overflow: hidden;\n        background-color: ").concat(r,';\n      ">\n        <img src="').concat(e.profilePictureUrl,'" style="\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        " />\n      </div>'):'<div style="\n        background-color: '.concat(r,";\n        width: ").concat(a,"px;\n        height: ").concat(a,"px;\n        border-radius: 50%;\n        border: 3px solid white;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-weight: bold;\n        font-size: ").concat(.4*a,'px;\n      ">').concat((null===(t=e.displayName[0])||void 0===t?void 0:t.toUpperCase())||"?","</div>");return g().divIcon({className:"custom-div-icon",html:n,iconSize:[a,a],iconAnchor:[a/2,a/2]})};var D=(0,r.memo)(function(e){var t;let{players:s,currentPlayerUid:n,isKiller:l,isEliminated:i=!1,selectedPlayerId:o,onPlayerClick:d,onMapClick:u,className:m="",skillchecks:x=[],escapeArea:D,onEnableLocation:k}=e,[w,E]=(0,r.useState)(null),[C,A]=(0,r.useState)([37.7749,-122.4194]),[S,P]=(0,r.useState)(17),[M,F]=(0,r.useState)(!0),T=(0,r.useMemo)(()=>l&&!i?[]:x,[x,l,i]),L=(0,r.useMemo)(()=>{if(l&&!i)return console.log("\uD83D\uDDFA️ DEBUG: Hiding escape area from killer"),null;let e=(null==D?void 0:D.isRevealed)?D:null;return console.log("\uD83D\uDDFA️ DEBUG: Escape area visibility check:",{escapeAreaExists:!!D,isRevealed:null==D?void 0:D.isRevealed,isKiller:l,isEliminated:i,willShow:!!e}),e},[D,l,i]),R=(0,r.useMemo)(()=>{let e=Date.now(),t=s.filter(t=>t.location&&t.isAlive&&t.lastLocationUpdate&&e-t.lastLocationUpdate<3e4);return i||l?t:t.filter(e=>"survivor"===e.role||e.uid===n)},[s,i,l,n]),_=s.find(e=>e.uid===n);(0,r.useEffect)(()=>{if(null==_?void 0:_.location)A([_.location.latitude,_.location.longitude]),F(!1);else if(R.length>0){let e=R[0];A([e.location.latitude,e.location.longitude]),F(!1)}},[null==_?void 0:_.location,R]),(0,r.useEffect)(()=>{if(!w||0===R.length)return;let e=setTimeout(()=>{if(o){let e=R.find(e=>e.uid===o);if(null==e?void 0:e.location){w.setView([e.location.latitude,e.location.longitude],18,{animate:!0});return}}if(1===R.length){let e=R[0];w.setView([e.location.latitude,e.location.longitude],17,{animate:!0})}else{let e=g().latLngBounds(R.map(e=>[e.location.latitude,e.location.longitude]));w.fitBounds(e,{padding:[30,30],maxZoom:18,animate:!0})}},150);return()=>clearTimeout(e)},[w,R,o]);let G=(e,t)=>c.E1.calculateDistance(e,t),U=e=>{let t=Math.floor((Date.now()-e)/1e3);return t<60?"".concat(t,"s ago"):"".concat(Math.floor(t/60),"m ago")},B=e=>{let t=e.completedBy.length>0?e.completedBy.map(e=>{let t=s.find(t=>t.uid===e);return(null==t?void 0:t.displayName)||"Unknown Player"}).join(", "):"Not completed yet";return(0,a.jsx)(p,{position:[e.location.latitude,e.location.longitude],icon:f(e),children:(0,a.jsx)(b,{children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/30 p-3 text-sm bg-granny-bg text-granny-text",children:[(0,a.jsxs)("div",{className:"font-bold flex items-center gap-2 text-granny-text",children:[(0,a.jsx)("span",{children:"⚡ Skillcheck"}),e.isCompleted&&(0,a.jsx)("span",{className:"text-granny-success",children:"✓"})]}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted mt-2",children:["Status: ",e.isCompleted?"Completed":"Pending"]}),e.isCompleted&&e.completedAt&&(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted",children:["Completed: ",new Date(e.completedAt).toLocaleTimeString()]}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted mt-1",children:["Completed by: ",t]}),!e.isCompleted&&(0,a.jsx)("div",{className:"text-xs text-granny-warning mt-2 font-medium",children:"\uD83D\uDCCD Get close to start the skillcheck minigame"})]})})},e.id)},I=e=>{if(!e.location)return null;let t=e.uid===n,s=o===e.uid,r=(null==_?void 0:_.location)&&!t?G(_.location,e.location):null,c=d&&(i||l||!l&&"survivor"===e.role);return(0,a.jsx)(p,{position:[e.location.latitude,e.location.longitude],icon:N(e,t||s),eventHandlers:c?{click:()=>d(e.uid)}:void 0,children:(0,a.jsx)(b,{children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/30 p-3 text-sm bg-granny-bg text-granny-text",children:[(0,a.jsx)("div",{className:"font-bold text-granny-text",children:e.displayName}),(0,a.jsxs)("div",{className:"text-xs mt-1 ".concat("killer"===e.role?"text-granny-danger":"text-granny-survivor"),children:["killer"===e.role?"\uD83D\uDD2A Killer":"\uD83C\uDFC3 Survivor",!e.isAlive&&(0,a.jsx)("span",{className:"text-granny-error",children:" (Eliminated)"})]}),null!==r&&(0,a.jsxs)("div",{className:"text-xs text-granny-text mt-1",children:["Distance: ",r<1e3?"".concat(Math.round(r),"m"):"".concat((r/1e3).toFixed(1),"km")]}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted mt-1",children:["Updated: ",U(e.lastLocationUpdate)]}),e.location.accuracy&&(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted",children:["Accuracy: \xb1",Math.round(e.location.accuracy),"m"]})]})})},e.uid)};if(0===R.length){let e=l?"\uD83D\uDCCD Waiting for survivor locations...":"\uD83D\uDCCD Waiting for player locations...",t=l?"Survivors need to enable location sharing to appear on the map":"Players need to enable location sharing to appear on the map";return(0,a.jsx)("div",{className:"glass-card border border-granny-border/30 p-6 text-center ".concat(m),children:(0,a.jsxs)("div",{className:"text-granny-text",children:[(0,a.jsx)("p",{className:"font-semibold text-lg mb-2",children:e}),(0,a.jsx)("p",{className:"text-sm text-granny-text-muted mb-4",children:t}),!(null==_?void 0:_.location)&&k&&(0,a.jsx)("button",{onClick:k,className:"btn-primary px-4 py-2 text-sm",children:"\uD83D\uDCCD Enable My Location"})]})})}if(M)return(0,a.jsx)("div",{className:"glass-card border border-granny-border/30 p-6 text-center ".concat(m),children:(0,a.jsxs)("div",{className:"text-granny-text",children:[(0,a.jsx)("p",{className:"font-semibold text-lg flex items-center justify-center gap-2",children:"\uD83D\uDDFA️ Loading map..."}),(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-granny-danger border-t-transparent rounded-full animate-spin mx-auto mt-3"})]})});let z=R.filter(e=>"survivor"===e.role).length;return R.filter(e=>"killer"===e.role).length,(0,a.jsxs)("div",{className:"glass-card border-2 ".concat(i?"border-granny-text-muted/30":l?"border-granny-danger/30":"border-granny-survivor/30"," ").concat(m),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-granny-border/20 ".concat(i?"glass-card border-granny-text-muted/20 bg-granny-text-muted/5":l?"glass-card border-granny-danger/20 bg-granny-danger/5":"glass-card border-granny-survivor/20 bg-granny-survivor/5"),children:[(0,a.jsx)("h3",{className:"font-bold text-lg ".concat(i?"text-granny-text":l?"text-granny-danger":"text-granny-survivor"," text-center"),children:i?"\uD83D\uDC7B Spectator Map":l?"\uD83C\uDFAF Killer Tracking Map":"\uD83D\uDDFA️ Survivor Map"}),(0,a.jsx)("div",{className:"text-sm ".concat(i?"text-granny-text-muted":l?"text-granny-danger/80":"text-granny-survivor/80"," text-center mt-2"),children:l||i?"".concat(z," survivor").concat(1!==z?"s":""," visible"):"".concat(z," survivor").concat(1!==z?"s":""," visible (including you)")})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{style:{height:"400px",width:"100%"},onClick:u,children:(0,a.jsxs)(h,{center:C,zoom:S,style:{height:"100%",width:"100%"},ref:E,children:[(0,a.jsx)(v,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),R.map(e=>I(e)),T.map(e=>B(e)),L&&(console.log("\uD83D\uDDFA️ DEBUG: Rendering escape area marker NOW"),(e=>{console.log("\uD83D\uDDFA️ DEBUG: Creating escape area marker:",{id:e.id,location:e.location,isRevealed:e.isRevealed});let t=e.escapedPlayers.length>0?e.escapedPlayers.map(e=>{let t=s.find(t=>t.uid===e);return(null==t?void 0:t.displayName)||"Unknown Player"}).join(", "):"None yet";return(0,a.jsx)(p,{position:[e.location.latitude,e.location.longitude],icon:j(),children:(0,a.jsx)(b,{children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/30 p-3 text-sm bg-granny-bg text-granny-text",children:[(0,a.jsxs)("div",{className:"font-bold flex items-center gap-2 text-granny-text",children:[(0,a.jsx)("span",{children:"\uD83D\uDEAA Escape Area"}),(0,a.jsx)("span",{className:"text-purple-400",children:"✨"})]}),(0,a.jsx)("div",{className:"text-xs text-granny-success mt-1 font-medium",children:"Status: Escape zone active!"}),e.revealedAt&&(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted",children:["Revealed: ",new Date(e.revealedAt).toLocaleTimeString()]}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted mt-1",children:["Escaped players: ",t]}),(0,a.jsx)("div",{className:"text-xs text-purple-400 mt-2 font-medium",children:"\uD83D\uDCCD Get close to escape and win the game!"})]})})},e.id)})(L)),R.map(e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.accuracy)&&!(e.location.accuracy>100)?(0,a.jsx)(y,{center:[e.location.latitude,e.location.longitude],radius:e.location.accuracy,pathOptions:{color:"killer"===e.role?"#DC2626":"#3B82F6",fillOpacity:.1,weight:1}},"".concat(e.uid,"-accuracy")):null})]})}),(0,a.jsxs)("div",{className:"absolute bottom-4 left-4 glass-card border border-granny-border/30 p-3 text-xs shadow-xl z-[1000]",children:[(0,a.jsx)("div",{className:"font-semibold text-granny-text mb-2 flex items-center gap-1",children:"\uD83D\uDDFA️ Legend"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-granny-surface ".concat(l?"bg-granny-danger":"bg-granny-survivor")}),(0,a.jsxs)("span",{className:"text-granny-text font-medium",children:["You (",l?"\uD83D\uDD2A Killer":"\uD83D\uDEE1️ Survivor",")"]})]}),z>(l?0:1)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-granny-survivor border-2 border-granny-surface"}),(0,a.jsx)("span",{className:"text-granny-text-muted",children:"Other Survivors"})]}),(l||i)&&R.some(e=>"killer"===e.role&&e.uid!==n)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-granny-danger border-2 border-granny-surface"}),(0,a.jsx)("span",{className:"text-granny-text-muted",children:"Other Killers"})]}),T.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-granny-warning border-2 border-granny-surface"}),(0,a.jsx)("span",{className:"text-granny-text-muted",children:"⚡ Pending Skillchecks"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-granny-success border-2 border-granny-surface"}),(0,a.jsx)("span",{className:"text-granny-text-muted",children:"✅ Completed Skillchecks"})]})]}),L&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-500 border-2 border-granny-surface"}),(0,a.jsx)("span",{className:"text-granny-text-muted",children:"\uD83D\uDEAA Escape Area"})]}),o&&(0,a.jsxs)("div",{className:"text-xs text-granny-survivor mt-2 pt-2 border-t border-granny-border/30",children:["\uD83D\uDCCD Viewing: ",null===(t=R.find(e=>e.uid===o))||void 0===t?void 0:t.displayName]}),!l&&!i&&(0,a.jsx)("div",{className:"text-xs text-granny-text-muted mt-2 italic",children:"\uD83D\uDD12 Killers are hidden from your view"}),(d||u)&&(0,a.jsx)("div",{className:"text-xs text-granny-text-muted mt-2 italic",children:"\uD83D\uDC46 Click players to view • Click map to reset view"})]}),(0,a.jsx)("div",{className:"absolute top-4 right-4 glass-card border border-granny-border/30 p-2 text-xs shadow-lg z-[1000]",children:(0,a.jsx)("div",{className:"text-granny-text-muted font-medium",children:"\uD83D\uDCF1 Pinch to zoom • Drag to pan"})})]}),(0,a.jsx)("div",{className:"p-3 text-xs text-granny-text-muted text-center border-t border-granny-border/20",children:"\uD83D\uDD04 Updates every 5 seconds • \uD83D\uDCCD Tap markers for details"})]})});function k(e){var t;let{currentPlayer:s,nearestSurvivor:n,className:l=""}=e,[i,o]=(0,r.useState)({bearing:0,distance:0,isVisible:!1}),[d,u]=(0,r.useState)(null);if((0,r.useEffect)(()=>{if(!s.location||!n.location){o(e=>({...e,isVisible:!1}));return}let e=c.E1.calculateDistance(s.location,n.location);o({bearing:c.E1.calculateBearing(s.location,n.location),distance:e,isVisible:e<=100})},[s.location,n.location]),(0,r.useEffect)(()=>{let e=!0,t=null;return(async()=>{if(e){if(!("DeviceOrientationEvent"in window)){console.log("ProximityArrow: DeviceOrientationEvent not supported");return}if("function"==typeof DeviceOrientationEvent.requestPermission)try{let e=await DeviceOrientationEvent.requestPermission();if("granted"!==e){console.log("ProximityArrow: Device orientation permission denied");return}}catch(e){console.log("ProximityArrow: Error requesting orientation permission:",e);return}t=t=>{if(!e)return;let s=t.alpha;null===s&&void 0!==t.webkitCompassHeading&&(s=360-t.webkitCompassHeading),null!==s&&e&&u(s)},window.addEventListener("deviceorientation",t)}})(),()=>{e=!1,t&&window.removeEventListener("deviceorientation",t)}},[]),!i.isVisible)return null;let m=null!==d?i.bearing-d:i.bearing,x=i.distance<=25,g=i.distance<=50,h=x?"text-red-600":g?"text-orange-500":"text-yellow-500";return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 ".concat(l),children:(0,a.jsxs)("div",{className:"".concat(x?"bg-red-100 border-red-600":g?"bg-orange-100 border-orange-500":"bg-yellow-100 border-yellow-500"," rounded-lg p-3 border-2 shadow-lg ").concat(x?"animate-pulse":g?"animate-bounce":""),children:[(0,a.jsxs)("div",{className:"text-center mb-2",children:[(0,a.jsx)("div",{className:"text-xs font-bold ".concat(h),children:"\uD83C\uDFAF TARGET NEARBY"}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:n.displayName})]}),(0,a.jsx)("div",{className:"flex items-center justify-center mb-2",children:(0,a.jsx)("div",{className:"transform transition-transform duration-500 ".concat(h),style:{transform:"rotate(".concat(m,"deg)"),fontSize:"32px",lineHeight:1},children:"↑"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm font-bold ".concat(h),children:(t=i.distance)<10?"".concat(Math.round(t),"m"):t<100?"".concat(5*Math.round(t/5),"m"):"".concat(10*Math.round(t/10),"m")}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:x?"Very Close!":g?"Close":"Nearby"})]}),null===d&&(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center mt-1",children:"Compass: N/A"})]})})}function w(e){let{isOpen:t,onSuccess:s,onFailure:n,onClose:l,skillcheckId:i}=e,[o,c]=(0,r.useState)(0),[d,u]=(0,r.useState)(0),[m,x]=(0,r.useState)(30),[g,h]=(0,r.useState)(180),[v,p]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),[f,j]=(0,r.useState)(0),[N,D]=(0,r.useState)(0),k=(0,r.useRef)(),w=(0,r.useCallback)(()=>{let e=20+20*Math.random();x(e),u(Math.random()*(360-e))},[]),E=(0,r.useCallback)(()=>{h(120+180*Math.random())},[]),C=(0,r.useCallback)(()=>{console.log("Skillcheck success!"),p(!1),y(!1),s()},[s]),A=(0,r.useCallback)(()=>{console.log("Skillcheck failed!"),p(!1),y(!1),n()},[n]);(0,r.useEffect)(()=>{t&&!b&&(c(0),j(0),D(0),w(),E(),y(!0),p(!0),console.log("Skillcheck minigame started for:",i))},[t,b,i,w,E]),(0,r.useEffect)(()=>{b&&f>=15&&C()},[f,b,C]),(0,r.useEffect)(()=>{if(!v)return;let e=()=>{c(e=>(e+g/60)%360),k.current=requestAnimationFrame(e)};return k.current=requestAnimationFrame(e),()=>{k.current&&cancelAnimationFrame(k.current)}},[v,g]);let S=(0,r.useCallback)(e=>{if("Space"===e.code&&v){e.preventDefault();let t=(d+m)%360;(d<t?o>=d&&o<=t:o>=d||o<=t)?(j(e=>e+1),w(),E(),console.log("Hit! Total hits:",f+1,"New speed:",g)):(D(e=>{let t=e+1;return t>=3&&A(),t}),console.log("Miss! Total misses:",N+1))}},[o,d,m,v,f,N,g,w,E,A]),P=(0,r.useCallback)(e=>{v&&(e.preventDefault(),S({code:"Space",preventDefault:()=>{}}))},[v,S]);if((0,r.useEffect)(()=>{if(t)return document.addEventListener("keydown",S),document.addEventListener("touchstart",P),()=>{document.removeEventListener("keydown",S),document.removeEventListener("touchstart",P)}},[t,S,P]),(0,r.useEffect)(()=>()=>{k.current&&cancelAnimationFrame(k.current)},[]),!t)return null;let M=(d+m)%360,F=(d-90)*Math.PI/180,T=(M-90)*Math.PI/180,L=m>180?1:0,R=["M 140 140","L ".concat(140+90*Math.cos(F)," ").concat(140+90*Math.sin(F)),"A 90 90 0 ".concat(L," 1 ").concat(140+90*Math.cos(T)," ").concat(140+90*Math.sin(T)),"Z"].join(" ");return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"glass-modal max-w-lg w-full text-granny-text text-center animate-slide-up",children:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚡"}),(0,a.jsx)("h2",{className:"text-3xl font-bold mb-3 text-granny-warning",children:"SKILLCHECK"}),(0,a.jsx)("p",{className:"text-granny-text-muted mb-6",children:"Hit the green zone when the needle passes through"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-center items-center gap-6 mb-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-granny-success",children:f}),(0,a.jsx)("div",{className:"text-sm text-granny-text-muted",children:"Hits"})]}),(0,a.jsx)("div",{className:"text-6xl text-granny-text-muted",children:"/"}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-granny-text",children:15}),(0,a.jsx)("div",{className:"text-sm text-granny-text-muted",children:"Required"})]})]}),(0,a.jsx)("div",{className:"w-full bg-granny-surface rounded-full h-2 mb-3 overflow-hidden",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-granny-success/60 to-granny-success h-2 rounded-full transition-all duration-500",style:{width:"".concat(Math.min(100,f/15*100),"%")}})}),N>0&&(0,a.jsx)("div",{className:"flex justify-center gap-1 mt-2",children:Array.from({length:3},(e,t)=>(0,a.jsx)("div",{className:"w-3 h-3 rounded-full border-2 ".concat(t<N?"bg-granny-error border-granny-error":"border-granny-border/50")},t))})]})]}),(0,a.jsxs)("div",{className:"relative mx-auto mb-8",style:{width:"280px",height:"280px"},children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-granny-surface/30 border-4 border-granny-border/50"}),(0,a.jsxs)("svg",{width:"280",height:"280",className:"transform -rotate-90 relative z-10",children:[(0,a.jsx)("circle",{cx:"140",cy:"140",r:"90",stroke:"rgba(42, 42, 45, 0.8)",strokeWidth:"12",fill:"none"}),(0,a.jsx)("path",{d:R.replace(/150/g,"140").replace(/100/g,"90"),fill:"rgba(45, 90, 61, 0.7)",stroke:"#2d5a3d",strokeWidth:"3",className:"animate-pulse"}),(0,a.jsx)("line",{x1:"140",y1:"140",x2:140+90*Math.cos((o-90)*Math.PI/180),y2:140+90*Math.sin((o-90)*Math.PI/180),stroke:"#c41e3a",strokeWidth:"3",strokeLinecap:"round",className:"drop-shadow-lg"}),(0,a.jsx)("circle",{cx:"140",cy:"140",r:"6",fill:"#c41e3a",className:"drop-shadow-md"})]}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-granny-warning/20 via-transparent to-granny-danger/20 animate-pulse"})]}),(0,a.jsxs)("div",{className:"space-y-3 text-granny-text-muted",children:[(0,a.jsxs)("div",{className:"glass-card border border-granny-border/20 p-4",children:[(0,a.jsx)("p",{className:"font-medium text-granny-text mb-2",children:"\uD83C\uDFAF Hit the green zone to progress"}),(0,a.jsx)("p",{className:"text-sm",children:"⌨️ Press SPACE or tap when needle is in green"})]}),N>0&&(0,a.jsx)("div",{className:"glass-card border border-granny-error/30 bg-granny-error/10 p-3",children:(0,a.jsxs)("p",{className:"text-sm text-granny-error font-medium",children:["⚠️ ",3-N," miss",3-N!=1?"es":""," remaining"]})})]}),!b&&(0,a.jsx)("button",{onClick:l,className:"btn-ghost mt-6 px-6 py-3",children:"✕ Close"})]})})})}function E(e){var t,d,m,x,g,h,v,p,b,y,f,j,N,E,A;let{params:S}=e,{user:P}=(0,l.a)(),{profile:M}=(0,i.G)(),F=(0,n.useRouter)(),{playGameStart:T,playGameEnd:L,playElimination:R,playCountdown:_,vibrate:G}=function(){let e=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=()=>{e.current||(e.current=new(window.AudioContext||window.webkitAudioContext))};return document.addEventListener("click",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0}),()=>{document.removeEventListener("click",t),document.removeEventListener("touchstart",t)}},[]);let t=function(t,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;if(!e.current)return;let r=e.current.createOscillator(),n=e.current.createGain();r.connect(n),n.connect(e.current.destination),r.frequency.value=t,r.type="sine",n.gain.setValueAtTime(0,e.current.currentTime),n.gain.linearRampToValueAtTime(a,e.current.currentTime+.01),n.gain.linearRampToValueAtTime(0,e.current.currentTime+s),r.start(e.current.currentTime),r.stop(e.current.currentTime+s)};return{playGameStart:()=>{t(440,.2),setTimeout(()=>t(554,.2),200),setTimeout(()=>t(659,.4),400)},playGameEnd:()=>{t(659,.3),setTimeout(()=>t(554,.3),300),setTimeout(()=>t(440,.6),600)},playElimination:()=>{t(220,.5,.4),setTimeout(()=>t(196,.8,.4),200)},playCountdown:()=>{t(800,.1)},vibrate:e=>{"vibrate"in navigator&&navigator.vibrate(e)}}}(),[U,B]=(0,r.useState)(null),I=e=>e.escapearea||e.escapeArea,[z,O]=(0,r.useState)(!0),[H,K]=(0,r.useState)(""),[V,Y]=(0,r.useState)(null),[W,q]=(0,r.useState)(0),[Z,J]=(0,r.useState)(0),[Q,X]=(0,r.useState)(0),[$,ee]=(0,r.useState)(!1),[et,es]=(0,r.useState)(!1),[ea,er]=(0,r.useState)(!1),[en,el]=(0,r.useState)(!1),[ei,eo]=(0,r.useState)(""),[ec,ed]=(0,r.useState)(!1),[eu,em]=(0,r.useState)(null),[ex,eg]=(0,r.useState)(!1),[eh,ev]=(0,r.useState)(null),[ep,eb]=(0,r.useState)(!1),[ey,ef]=(0,r.useState)(null),[ej,eN]=(0,r.useState)(!1),[eD,ek]=(0,r.useState)(new Set),[ew,eE]=(0,r.useState)(!1),[eC,eA]=(0,r.useState)(null),[eS,eP]=(0,r.useState)(!1),[eM,eF]=(0,r.useState)(new Set),[eT,eL]=(0,r.useState)(!1),[eR,e_]=(0,r.useState)(!1),eG=async e=>{if(P){console.log("Real skillcheck succeeded!",e),ev(null),ef(null),e_(!0),setTimeout(()=>{e_(!1)},2e3),eF(t=>{let s=new Set(t);return s.add(e),s}),eC===e&&eA(null),G(200);try{await (0,o.completeSkillcheck)(S.roomCode,e,P.id)}catch(e){console.error("Error completing skillcheck:",e)}}},eU=e=>{console.log("Real skillcheck failed!",e),ev(null),ef(null),G([100,50,100])},eB=U?U.players[(null==P?void 0:P.id)||""]:null,eI=(0,r.useCallback)(async()=>{if(P&&!eT){console.log("\uD83C\uDFC3 Player attempting escape!"),eL(!0),eN(!1),eb(!1),eP(!1);try{console.log("\uD83C\uDFC3 Calling markPlayerEscaped for player:",P.id);let e=(0,o.markPlayerEscaped)(S.roomCode,P.id,!1),t=new Promise((e,t)=>setTimeout(()=>t(Error("Escape timeout")),15e3));await Promise.race([e,t]),console.log("✅ Escape processing completed"),G([200,100,200,100,200]),setTimeout(async()=>{console.log("Force checking game end after escape");let{checkGameEnd:e}=await Promise.resolve().then(s.bind(s,4208));await e(S.roomCode)},500)}catch(e){console.error("❌ Error escaping:",e),eL(!1),e instanceof Error&&"Escape timeout"===e.message?alert("Escape is taking longer than expected. Please wait or try again."):alert("Failed to escape. Please try again.")}}},[P,S.roomCode,G,eT]),ez=e=>{let t=eY.find(t=>t.uid===e);(null==eB?void 0:eB.isAlive)&&(!eB.isAlive||"killer"===eB.role||"survivor"===eB.role&&(null==t?void 0:t.role)==="survivor")&&(null==t?void 0:t.location)&&em(e)},eO=(0,r.useCallback)(async()=>{if(!P||!U||$)return;ee(!0);let e=setTimeout(()=>{console.warn("Elimination timeout - resetting button state"),ee(!1)},15e3);try{let e=Object.values(U.players).filter(e=>"killer"===e.role&&e.isAlive),t=e.length>0?e[Math.floor(Math.random()*e.length)].uid:void 0;console.log("Eliminating player with eliminatedBy:",t),await (0,o.eliminatePlayer)(S.roomCode,P.id,t),R(),G([300,100,300,100,300]),setTimeout(async()=>{console.log("Force checking game end after elimination");let{checkGameEnd:e}=await Promise.resolve().then(s.bind(s,4208));await e(S.roomCode)},500)}catch(e){console.error("Error eliminating player:",e),ee(!1)}finally{clearTimeout(e)}},[P,U,S.roomCode,R,G,$]);(0,r.useEffect)(()=>{eB&&!eB.isAlive&&$&&(console.log("Player eliminated via real-time update - resetting button state"),ee(!1))},[null==eB?void 0:eB.isAlive,$]),(0,r.useEffect)(()=>{(null==eB?void 0:eB.hasEscaped)&&eT&&(console.log("Player escaped via real-time update - resetting button state"),eL(!1))},[null==eB?void 0:eB.hasEscaped,eT]);let eH=(0,r.useCallback)(async()=>{P&&(console.log("Game ending, clearing location tracking"),c.E1.stopWatching(),await (0,o.clearPlayerLocation)(S.roomCode,P.id),el(!1))},[P,S.roomCode]);(0,r.useEffect)(()=>{if(!P||!M)return;let e=!0,t=null,s=null,a=(0,o.subscribeToRoom)(S.roomCode,a=>{var r,n;if(e){if(!a){console.log("Room fetch failed, but may be temporary"),V||(t=setTimeout(()=>{e&&(K("Room not found"),O(!1))},3e3));return}if(t&&(clearTimeout(t),t=null),K(""),Y(a),null===(r=a.escapeArea)||void 0===r||!r.isRevealed||(null==U?void 0:null===(n=U.escapeArea)||void 0===n?void 0:n.isRevealed)||(ed(!1),setTimeout(()=>ed(!0),100)),!a.players[P.id]){console.log("User has been kicked from game:",P.id),K("You have been removed from this room"),s=setTimeout(()=>{e&&F.push("/")},2e3);return}B(a),O(!1),"headstart"!==a.status&&"active"!==a.status||ea||en||(console.log("\uD83D\uDDFA️ Showing location permission modal"),er(!0)),"waiting"===a.status?F.push("/room/".concat(S.roomCode)):"finished"===a.status&&(eH(),F.push("/results/".concat(S.roomCode)))}});return()=>{e=!1,t&&clearTimeout(t),s&&clearTimeout(s),a()}},[P,M,S.roomCode,F,ea,en,V,eH,null==U?void 0:null===(t=U.escapeArea)||void 0===t?void 0:t.isRevealed]),(0,r.useEffect)(()=>{if(!U)return;let e=()=>{let e=Date.now();if("headstart"===U.status&&U.headstart_started_at&&J(Math.max(0,U.headstart_started_at+6e4*U.settings.headstartMinutes-e)),"active"===U.status&&U.game_started_at){let t=Math.max(0,U.game_started_at+6e4*U.settings.roundLengthMinutes-e);q(t),et||(T(),G([200,100,200]),es(!0)),t<=1e4&&t>0&&Math.floor(t/1e3)!==Math.floor((t-1e3)/1e3)&&(_(),G(100)),t<=0&&"active"===U.status&&U.game_started_at&&Date.now()-U.game_started_at>5e3&&(console.log("Game timer expired on client side, triggering game end check"),Promise.resolve().then(s.bind(s,4208)).then(e=>{let{checkGameEnd:t}=e;t(S.roomCode)}))}let t=I(U);if("active"===U.status&&U.escape_timer_started_at&&(null==t?void 0:t.isRevealed)){let t=Math.max(0,U.escape_timer_started_at+6e5-e);if(X(t),t<=6e4&&t>0&&Math.floor(t/1e3)!==Math.floor((t-1e3)/1e3)){let e=Math.floor(t/1e3);e<=10?(_(),G([200,100,200])):e%10==0&&(T(),G(150))}t<=0&&U.escape_timer_started_at&&e-U.escape_timer_started_at>6e5&&(console.log("Escape timer expired on client side, triggering auto-elimination"),Promise.resolve().then(s.bind(s,4208)).then(e=>{let{checkEscapeTimerExpired:t}=e;t(S.roomCode)}))}else X(0)};e();let t=setInterval(e,1e3),a=null;return"active"===U.status&&(a=setInterval(async()=>{console.log("Auto-checking game end status");let{checkGameEnd:e}=await Promise.resolve().then(s.bind(s,4208));await e(S.roomCode)},1e3)),()=>{clearInterval(t),a&&clearInterval(a)}},[U,et,T,_,G,S.roomCode]);let eK=(0,r.useCallback)(e=>{var t;if(!U||!(null==eB?void 0:eB.isAlive)||"survivor"!==eB.role)return;if(U.skillchecks&&(null===(t=U.settings.skillchecks)||void 0===t?void 0:t.enabled))for(let t of U.skillchecks.filter(e=>!e.isCompleted&&!eM.has(e.id))){let s=c.E1.calculateDistance(e,t.location);if(s<=50){ey||eh||eC||(console.log("Near skillcheck:",t.id,"distance:",s),eD.has(t.id)?eA(t.id):(ef(t.id),G(100)));return}}let s=I(U);if((null==s?void 0:s.isRevealed)&&!eB.hasEscaped){let t=c.E1.calculateDistance(e,s.location);t<=50?ej||ep||eS||(console.log("Near escape area, distance:",t),eb(!0),ew?eP(!0):(eN(!0),G([100,50,100]))):ep&&(eb(!1),eN(!1),eP(!1))}if((ey||eC)&&U.skillchecks){let t=ey||eC,s=U.skillchecks.find(e=>e.id===t);s&&c.E1.calculateDistance(e,s.location)>50&&(ef(null),eA(null))}},[U,eB,ey,eh,ej,ep,eM,eD,ew,eC,eS,G]);(0,r.useEffect)(()=>{(null==U?void 0:U.status)==="waiting"&&(eF(new Set),eL(!1),ek(new Set),eE(!1),eA(null),eP(!1))},[null==U?void 0:U.status]),(0,r.useEffect)(()=>{if(P&&U&&en&&("active"===U.status||"headstart"===U.status))return console.log("Starting location tracking for user:",P.id),c.E1.startWatching(async e=>{await (0,o.updatePlayerLocation)(S.roomCode,P.id,e),(null==eB?void 0:eB.role)==="survivor"&&(null==eB?void 0:eB.isAlive)&&eK(e)},e=>{console.error("Location tracking error:",e),eo("Location error: ".concat(e))},c.LL),()=>{console.log("Stopping location tracking"),c.E1.stopWatching()}},[P,U,en,S.roomCode,null==eB?void 0:eB.isAlive,null==eB?void 0:eB.role,eK]);let eV=(0,r.useCallback)(e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60),":").concat((t%60).toString().padStart(2,"0"))},[]),{players:eY,aliveKillers:eW,aliveSurvivors:eq,deadPlayers:eZ,escapedPlayers:eJ}=(0,r.useMemo)(()=>{if(!U)return{players:[],aliveKillers:[],aliveSurvivors:[],deadPlayers:[],escapedPlayers:[]};let e=Object.values(U.players);return{players:e,aliveKillers:e.filter(e=>"killer"===e.role&&e.isAlive),aliveSurvivors:e.filter(e=>"survivor"===e.role&&e.isAlive&&!e.hasEscaped),deadPlayers:e.filter(e=>!e.isAlive&&!e.hasEscaped),escapedPlayers:e.filter(e=>e.hasEscaped)}},[U]),eQ=(0,r.useMemo)(()=>(null==eB?void 0:eB.role)==="killer"&&(null==eB?void 0:eB.location)&&U?eq.filter(e=>e.location).reduce((e,t)=>{if(!e)return t;let s=c.E1.calculateDistance(eB.location,e.location);return c.E1.calculateDistance(eB.location,t.location)<s?t:e},null):null,[null==eB?void 0:eB.role,null==eB?void 0:eB.location,eq,U]);if(z)return(0,a.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass-card p-8 text-center animate-slide-up",children:[(0,a.jsx)("div",{className:"text-xl text-granny-text mb-4 flex items-center justify-center gap-2",children:"\uD83C\uDFAE Loading game..."}),(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-granny-danger border-t-transparent rounded-full animate-spin mx-auto"})]})});if(H||!U)return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg pointer-events-none"}),(0,a.jsxs)("div",{className:"glass-card p-8 text-center animate-slide-up relative z-10",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"⚠️"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-granny-text mb-4",children:"Game Error"}),(0,a.jsx)("p",{className:"text-granny-error mb-6",children:H||"Game not found"}),(0,a.jsx)("button",{onClick:()=>F.push("/"),className:"btn-primary px-6 py-3",children:"\uD83C\uDFE0 Back to Home"})]})]});let eX="headstart"===U.status,e$="active"===U.status;return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col p-4 max-w-4xl mx-auto relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg pointer-events-none"}),(0,a.jsxs)("div",{className:"w-full glass-modal p-6 text-granny-text mb-4 relative z-10",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-3 animate-glow flex items-center justify-center gap-3 ".concat(eX?"text-granny-warning":"text-granny-danger"),children:eX?"⚡ HEADSTART":"\uD83D\uDD25 GAME ACTIVE"}),eX&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"text-5xl font-mono font-bold text-granny-warning animate-pulse",children:eV(Z)}),(0,a.jsx)("p",{className:"text-granny-text-muted flex items-center justify-center gap-2",children:"\uD83C\uDFC3 Time to hide and prepare"})]}),e$&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"text-5xl font-mono font-bold text-granny-danger animate-pulse",children:eV(W)}),(0,a.jsx)("p",{className:"text-granny-text-muted flex items-center justify-center gap-2",children:"⏰ Time remaining"})]}),e$&&(null==U?void 0:null===(d=U.escapeArea)||void 0===d?void 0:d.isRevealed)&&(null==U?void 0:null===(m=U.settings.skillchecks)||void 0===m?void 0:m.enabled)&&Q>0&&(0,a.jsxs)("div",{className:"mb-6 glass-card border-2 border-granny-survivor/50 bg-granny-survivor/10 p-4",children:[(0,a.jsxs)("div",{className:"text-4xl font-mono font-bold text-granny-survivor animate-pulse",children:["\uD83D\uDEAA ",eV(Q)]}),(0,a.jsx)("p",{className:"text-granny-survivor font-semibold",children:"ESCAPE TIMER - Reach the escape area!"}),(0,a.jsx)("p",{className:"text-xs text-granny-text-muted mt-2",children:"⚠️ Auto-elimination if time expires"})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"glass-card px-6 py-3 border-2 ".concat((null==eB?void 0:eB.role)==="killer"?"border-granny-danger/50 bg-granny-danger/10":"border-granny-survivor/50 bg-granny-survivor/10"),children:(0,a.jsxs)("span",{className:"font-semibold text-granny-text",children:["Your role: ",(0,a.jsx)("span",{className:"font-bold ".concat((null==eB?void 0:eB.role)==="killer"?"text-granny-danger":"text-granny-survivor"),children:(null==eB?void 0:eB.role)==="killer"?"\uD83D\uDD2A KILLER":"\uD83D\uDEE1️ SURVIVOR"})]})})}),(null===(x=U.settings.skillchecks)||void 0===x?void 0:x.enabled)&&(null==eB?void 0:eB.role)==="survivor"&&e$&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[U.skillchecks&&U.skillchecks.length>0&&(0,a.jsxs)("div",{className:"glass-card border border-granny-survivor/30 bg-granny-survivor/5 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-granny-survivor flex items-center gap-2",children:"⚡ Skillcheck Progress"}),(0,a.jsxs)("span",{className:"text-xs text-granny-survivor font-mono bg-granny-survivor/20 px-2 py-1 rounded",children:[U.skillchecks.filter(e=>e.isCompleted).length," / ",U.skillchecks.length]})]}),(0,a.jsx)("div",{className:"w-full bg-granny-surface rounded-full h-3 overflow-hidden",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-granny-survivor/60 to-granny-survivor h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:"".concat(U.skillchecks.filter(e=>e.isCompleted).length/U.skillchecks.length*100,"%")}})}),(U.allskillcheckscompleted||U.allSkillchecksCompleted)&&(0,a.jsx)("div",{className:"text-xs text-granny-success mt-2 font-semibold animate-pulse flex items-center gap-1",children:"✅ All skillchecks completed! Escape area revealed."})]}),(null===(g=U.escapeArea)||void 0===g?void 0:g.isRevealed)&&(0,a.jsxs)("div",{className:"glass-card border border-granny-survivor/50 bg-granny-survivor/10 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-granny-survivor flex items-center gap-2",children:"\uD83D\uDEAA Escape Area Active"}),U.escapeArea.escapedPlayers.length>0&&(0,a.jsxs)("span",{className:"text-xs text-granny-success font-mono bg-granny-success/20 px-2 py-1 rounded",children:[U.escapeArea.escapedPlayers.length," escaped"]})]}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-granny-survivor",children:"\uD83D\uDDFA️"}),(0,a.jsxs)("div",{children:["Find the purple door on the map to escape!"," ",Q>0&&(0,a.jsxs)("span",{className:"text-granny-warning font-semibold",children:[Math.ceil(Q/6e4)," min left!"]})]})]})]}),eB.hasEscaped&&(0,a.jsxs)("div",{className:"glass-card border border-granny-success/50 bg-granny-success/10 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-granny-success flex items-center gap-2",children:"\uD83C\uDF89 You Escaped!"}),(0,a.jsx)("div",{className:"text-xs text-granny-success mt-2",children:"Congratulations! You've won the game for all survivors."}),(0,a.jsx)("div",{className:"text-xs text-granny-text-muted mt-1 flex items-center gap-1",children:"⏳ Game should end automatically..."})]}),(null==P?void 0:P.id)===U.host_uid&&ep&&!eB.hasEscaped&&(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:[(0,a.jsx)("button",{onClick:eI,disabled:eT,className:"w-full bg-purple-500 text-white py-2 px-4 rounded-lg font-bold hover:bg-purple-600 disabled:opacity-50",children:eT?"⏳ Escaping...":"\uD83C\uDFC3 Manual Escape (Testing)"}),(0,a.jsx)("div",{className:"text-xs text-purple-600 mt-1",children:"Host testing escape functionality"})]})]})]}),(null==eB?void 0:eB.isAlive)&&(null==eB?void 0:eB.role)==="survivor"&&e$&&(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"glass-card border border-granny-error/30 bg-granny-error/5 p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDC80"}),(0,a.jsx)("div",{className:"text-granny-error font-bold text-lg",children:"Survivor Emergency"})]}),(0,a.jsx)("button",{onClick:eO,disabled:$,className:"w-full bg-granny-error hover:bg-granny-error/90 text-white font-bold py-4 px-8 rounded-xl text-lg disabled:opacity-50 shadow-xl hover:shadow-granny-error/30 transition-all duration-300 flex items-center justify-center gap-3 hover:scale-[1.02] active:scale-[0.98]",children:$?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Reporting Death..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-2xl",children:"⚡"}),(0,a.jsx)("span",{children:"I Was Caught!"})]})}),(0,a.jsx)("div",{className:"glass-card border border-granny-warning/20 bg-granny-warning/10 p-3 mt-4",children:(0,a.jsx)("p",{className:"text-xs text-granny-warning font-medium text-center flex items-center justify-center gap-2",children:"⚠️ Only press if you were physically tagged by a killer"})})]}),(null==U?void 0:null===(h=U.settings.skillchecks)||void 0===h?void 0:h.enabled)&&(0,a.jsxs)("div",{className:"glass-card border border-granny-survivor/30 bg-granny-survivor/5 p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"⚡"}),(0,a.jsx)("div",{className:"text-granny-survivor font-bold text-lg",children:"Skillcheck Training"})]}),(0,a.jsxs)("button",{onClick:()=>eg(!0),className:"w-full bg-granny-survivor hover:bg-granny-survivor/90 text-white font-bold py-4 px-6 rounded-xl shadow-xl hover:shadow-granny-survivor/30 transition-all duration-300 flex items-center justify-center gap-3 hover:scale-[1.02] active:scale-[0.98]",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFAF"}),(0,a.jsx)("span",{children:"Practice Mode"})]}),(0,a.jsx)("div",{className:"glass-card border border-granny-text-muted/20 bg-granny-text-muted/5 p-3 mt-4",children:(0,a.jsx)("p",{className:"text-xs text-granny-text-muted text-center flex items-center justify-center gap-2",children:"\uD83C\uDFAE Perfect your timing before the real challenge"})})]})]}),(null==eB?void 0:eB.isAlive)&&(null==eB?void 0:eB.role)==="killer"&&e$&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"glass-card border border-granny-danger/50 bg-granny-danger/10 p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[(0,a.jsx)("div",{className:"font-bold text-2xl mb-3 text-granny-danger animate-glow flex items-center justify-center gap-2",children:"\uD83D\uDD2A You are a KILLER!"}),(0,a.jsxs)("p",{className:"text-sm text-granny-text flex items-center justify-center gap-2",children:["\uD83C\uDFC3 Hunt down the survivors! They have"," ",(0,a.jsxs)("span",{className:"font-bold text-granny-danger",children:[Math.max(0,Math.floor(W/6e4))," minutes"]})," ","left to hide."]})]}),(null==U?void 0:null===(v=U.settings.skillchecks)||void 0===v?void 0:v.enabled)&&(null==U?void 0:U.skillchecks)&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-granny-danger/30",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-granny-danger mb-2 flex items-center gap-2",children:"⚡ Skillcheck Progress"}),(0,a.jsxs)("div",{className:"text-xs text-granny-text-muted mb-3 flex items-center gap-2",children:["\uD83D\uDCCA ",U.skillchecks.filter(e=>e.isCompleted).length," / ",U.skillchecks.length," completed by survivors"]}),(U.allskillcheckscompleted||U.allSkillchecksCompleted)&&(0,a.jsx)("div",{className:"glass-card text-xs bg-granny-error/20 border border-granny-error/50 text-granny-error px-3 py-2 rounded-lg mt-2 animate-pulse",children:"\uD83D\uDEA8 ALL SKILLCHECKS COMPLETE - Escape area is now active!"}),(null===(p=U.escapeArea)||void 0===p?void 0:p.isRevealed)&&!(U.allskillcheckscompleted||U.allSkillchecksCompleted)&&(0,a.jsx)("div",{className:"glass-card text-xs bg-granny-error/20 border border-granny-error/50 text-granny-error px-3 py-2 rounded-lg mt-2 animate-pulse",children:"\uD83D\uDEA8 Timer expired - Escape area is now active!"})]})]})}),(null==eB?void 0:eB.isAlive)&&e$&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/30 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center gap-2 ".concat((null==eB?void 0:eB.role)==="killer"?"text-granny-danger":"text-granny-survivor"),children:["\uD83D\uDDFA️ ",(null==eB?void 0:eB.role)==="killer"?"Tracking Map":"Survivor Map"]}),(0,a.jsx)("button",{onClick:()=>ed(!ec),className:"px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 ".concat((null==eB?void 0:eB.role)==="killer"?"bg-granny-danger/20 text-granny-danger border border-granny-danger/50 hover:bg-granny-danger/30":"bg-granny-survivor/20 text-granny-survivor border border-granny-survivor/50 hover:bg-granny-survivor/30"),children:ec?"\uD83D\uDC41️ Hide Map":"\uD83D\uDDFA️ Show Map"})]}),ec&&(0,a.jsx)(D,{players:eY,currentPlayerUid:(null==P?void 0:P.id)||"",isKiller:(null==eB?void 0:eB.role)==="killer",selectedPlayerId:eu,onPlayerClick:ez,onMapClick:()=>em(null),skillchecks:null==U?void 0:U.skillchecks,escapeArea:I(U),className:"mb-4",onEnableLocation:()=>er(!0)}),!ec&&(0,a.jsxs)("div",{className:"glass-card border-2 border-dashed p-6 text-center ".concat((null==eB?void 0:eB.role)==="killer"?"border-granny-danger/30 bg-granny-danger/5":"border-granny-survivor/30 bg-granny-survivor/5"),children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDFA️"}),(0,a.jsxs)("p",{className:"text-sm font-medium ".concat((null==eB?void 0:eB.role)==="killer"?"text-granny-danger":"text-granny-survivor"),children:['Click "Show Map" to see ',(null==eB?void 0:eB.role)==="killer"?"survivor locations":"your location and other survivors"]})]})]})}),!(null==eB?void 0:eB.isAlive)&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsxs)("div",{className:"glass-card border border-granny-text-muted/30 bg-granny-text-muted/10 p-6",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC80"}),(0,a.jsx)("div",{className:"font-bold text-xl mb-3 text-granny-text",children:"You have been eliminated"}),(0,a.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Watch the remaining players battle it out!"})]})}),e$&&(0,a.jsxs)("div",{className:"glass-card border border-granny-border/30 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-granny-text flex items-center gap-2",children:"\uD83D\uDC7B Spectator Map"}),(0,a.jsx)("button",{onClick:()=>ed(!ec),className:"px-4 py-2 bg-granny-surface border border-granny-border text-granny-text rounded-lg hover:bg-granny-surface-light text-sm font-semibold transition-all duration-200",children:ec?"\uD83D\uDC41️ Hide Map":"\uD83D\uDDFA️ Show Map"})]}),ec&&(0,a.jsx)(D,{players:eY,currentPlayerUid:(null==P?void 0:P.id)||"",isKiller:!1,isEliminated:!0,selectedPlayerId:eu,onPlayerClick:ez,onMapClick:()=>em(null),skillchecks:null==U?void 0:U.skillchecks,escapeArea:null==U?void 0:U.escapeArea,className:"mb-4",onEnableLocation:()=>er(!0)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-granny-danger flex items-center gap-2",children:["\uD83D\uDD2A Killers (",eW.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:eY.filter(e=>"killer"===e.role).map(e=>{let t=(null==eB?void 0:eB.role)==="killer"||!(null==eB?void 0:eB.isAlive);return(0,a.jsx)(C,{player:e,onClick:ez,canClick:t},e.uid)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-granny-survivor flex items-center gap-2",children:["\uD83D\uDEE1️ Survivors (",eq.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:eY.filter(e=>"survivor"===e.role).map(e=>(0,a.jsx)(C,{player:e,onClick:ez,canClick:!0},e.uid))})]})]}),eZ.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-granny-error flex items-center gap-2",children:["\uD83D\uDC80 Eliminated (",eZ.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:eZ.sort((e,t)=>(e.eliminatedAt||0)-(t.eliminatedAt||0)).map(e=>{let t=!(null==eB?void 0:eB.isAlive);return(0,a.jsx)(C,{player:e,onClick:ez,canClick:t},e.uid)})})]}),eJ.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-granny-success flex items-center gap-2",children:["\uD83C\uDF89 Escaped (",eJ.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:eJ.sort((e,t)=>(e.escapedAt||0)-(t.escapedAt||0)).map(e=>{let t=!(null==eB?void 0:eB.isAlive)||eB.hasEscaped;return(0,a.jsx)(C,{player:e,onClick:ez,canClick:t},e.uid)})})]})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>F.push("/room/".concat(S.roomCode)),className:"btn-ghost px-6 py-3",children:"\uD83C\uDFE0 Back to Room"})}),ei&&(0,a.jsx)("div",{className:"mt-4 glass-card p-4 border border-granny-warning/30 bg-granny-warning/10",children:(0,a.jsxs)("p",{className:"text-granny-warning text-sm font-medium flex items-center gap-2",children:["⚠️ ",ei]})}),en&&(0,a.jsx)("div",{className:"mt-4 glass-card p-4 border border-granny-success/30 bg-granny-success/10",children:(0,a.jsx)("p",{className:"text-granny-success text-sm font-medium flex items-center gap-2",children:"\uD83D\uDCCD Location sharing enabled"})}),(0,a.jsx)(u.Z,{isOpen:ea,onPermissionGranted:()=>{console.log("Location permission granted"),el(!0),er(!1),eo("")},onPermissionDenied:e=>{console.log("Location permission denied:",e),eo(e),er(!1)},onSkip:()=>{console.log("Location permission skipped"),er(!1)}}),(null==eB?void 0:eB.role)==="killer"&&(null==eB?void 0:eB.isAlive)&&e$&&eQ&&(null==eB?void 0:eB.location)&&(0,a.jsx)(k,{currentPlayer:eB,nearestSurvivor:eQ}),(0,a.jsx)(w,{isOpen:ex,onSuccess:()=>{console.log("Practice skillcheck succeeded!"),eg(!1),G(200)},onFailure:()=>{console.log("Practice skillcheck failed!"),eg(!1),G([100,50,100])},onClose:()=>eg(!1),skillcheckId:"practice"}),eh&&(0,a.jsx)(w,{isOpen:!0,onSuccess:()=>eG(eh),onFailure:()=>eU(eh),onClose:()=>{ev(null),ef(null)},skillcheckId:eh}),(null==eB?void 0:eB.isAlive)&&(null==eB?void 0:eB.role)==="survivor"&&e$&&(0,a.jsxs)("div",{className:"fixed bottom-20 right-4 z-30 space-y-2 max-w-xs",children:[eC&&(0,a.jsx)("div",{className:"relative group",onClick:()=>{ev(eC),eA(null)},children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/20 bg-granny-bg/95 backdrop-blur-md text-granny-text rounded-xl p-4 shadow-2xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-amber-500/20 hover:shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-200",children:(0,a.jsx)("span",{className:"text-white text-lg font-bold",children:"⚡"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-granny-text mb-1",children:"Skillcheck Available"}),(0,a.jsx)("div",{className:"text-xs text-granny-text-muted opacity-80",children:"Tap to start minigame"})]}),(0,a.jsx)("div",{className:"flex-shrink-0 w-6 h-6 bg-granny-border/20 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-granny-text-muted text-xs",children:"→"})})]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-400/10 to-yellow-500/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})}),eS&&!eT&&(0,a.jsx)("div",{className:"relative group",onClick:eI,children:(0,a.jsxs)("div",{className:"glass-card border border-granny-border/20 bg-granny-bg/95 backdrop-blur-md text-granny-text rounded-xl p-4 shadow-2xl cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-purple-500/20 hover:shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center shadow-md group-hover:scale-110 transition-transform duration-200",children:(0,a.jsx)("span",{className:"text-white text-lg",children:"\uD83D\uDEAA"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-semibold text-granny-text mb-1",children:"Escape Zone Ready"}),(0,a.jsx)("div",{className:"text-xs text-granny-text-muted opacity-80",children:"Tap to escape and win"})]}),(0,a.jsx)("div",{className:"flex-shrink-0 w-6 h-6 bg-granny-border/20 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-granny-text-muted text-xs",children:"→"})})]}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/10 to-purple-600/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})})]}),ey&&!eh&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-40 p-4",children:(0,a.jsx)("div",{className:"glass-modal max-w-md w-full text-granny-text text-center animate-slide-up",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"⚡"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-granny-warning mb-4",children:"Skillcheck Detected!"}),(0,a.jsx)("p",{className:"text-granny-text-muted mb-6",children:"You're near a skillcheck. Complete it to help your team progress!"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{ev(ey),ef(null)},className:"btn-primary flex-1 py-3",children:"⚡ Start Skillcheck"}),(0,a.jsx)("button",{onClick:()=>{ek(e=>{let t=new Set(e);return t.add(ey),t}),ef(null),eA(ey)},className:"btn-ghost flex-1 py-3",children:"\uD83D\uDD70️ Later"})]})]})})}),ej&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-40 p-4",children:(0,a.jsx)("div",{className:"glass-modal max-w-md w-full text-granny-text text-center animate-slide-up",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDEAA"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-400 mb-4",children:"Escape Area Found!"}),(0,a.jsxs)("p",{className:"text-granny-text-muted mb-6",children:["You've reached the escape zone! Escape now to save yourself!",Q>0&&(0,a.jsxs)("span",{className:"block mt-2 text-granny-warning font-semibold",children:["⏰ Time left: ",Math.ceil(Q/1e3),"s"]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:eI,disabled:eT,className:"btn-secondary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",children:eT?"⏳ Escaping...":"\uD83C\uDFC3 ESCAPE NOW!"}),(0,a.jsx)("button",{onClick:()=>{eE(!0),eN(!1),eP(!0)},className:"btn-ghost flex-1 py-3",children:"⏳ Not Yet"})]})]})})}),U&&(null==P?void 0:P.id)===U.host_uid&&(null===(b=U.settings.skillchecks)||void 0===b?void 0:b.enabled)&&(0,a.jsxs)("div",{className:"fixed bottom-4 right-4 bg-yellow-100 border-2 border-yellow-400 rounded-lg p-4 max-w-xs z-50",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-yellow-800 mb-2",children:"\uD83D\uDEE0️ Host Debug Panel"}),(0,a.jsxs)("div",{className:"text-xs mb-3 p-2 bg-white rounded border text-black",children:[(0,a.jsxs)("div",{children:["Skillchecks: ",(null===(y=U.skillchecks)||void 0===y?void 0:y.filter(e=>e.isCompleted).length)||0,"/",(null===(f=U.skillchecks)||void 0===f?void 0:f.length)||0]}),(0,a.jsxs)("div",{children:["All Complete: ",U.allskillcheckscompleted||U.allSkillchecksCompleted?"✅":"❌"]}),(0,a.jsxs)("div",{children:["Escape Area Exists: ",U.escapearea||U.escapeArea?"✅":"❌"]}),(0,a.jsxs)("div",{children:["Escape Area Revealed: ",(null===(j=U.escapearea)||void 0===j?void 0:j.isRevealed)||(null===(N=U.escapeArea)||void 0===N?void 0:N.isRevealed)?"✅":"❌"]}),(0,a.jsxs)("div",{children:["Escape Timer: ",U.escape_timer_started_at?"✅":"❌"]}),(0,a.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,a.jsx)("div",{className:"font-bold",children:"Game State Debug:"}),(0,a.jsxs)("div",{children:["Room Status: ",U.status]}),(0,a.jsxs)("div",{children:["Alive Survivors: ",eq.length]}),(0,a.jsxs)("div",{children:["Escaped Survivors: ",eJ.filter(e=>"survivor"===e.role).length]}),(0,a.jsxs)("div",{children:["Eliminated Survivors: ",eY.filter(e=>"survivor"===e.role&&!e.isAlive&&!e.hasEscaped).length]}),(0,a.jsxs)("div",{children:["Current Player Escaped: ",(null==eB?void 0:eB.hasEscaped)?"Yes":"No"]}),(0,a.jsxs)("div",{children:["Current Player Alive: ",(null==eB?void 0:eB.isAlive)?"Yes":"No"]})]}),(U.escapearea||U.escapeArea)&&(0,a.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200 text-black",children:(()=>{var e,t,s,r,n;let l=U.escapearea||U.escapeArea;return l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:["Escape Area ID: ",l.id]}),(0,a.jsxs)("div",{children:["Escape Area Coords: ",null===(t=l.location)||void 0===t?void 0:null===(e=t.latitude)||void 0===e?void 0:e.toFixed(6),", ",null===(r=l.location)||void 0===r?void 0:null===(s=r.longitude)||void 0===s?void 0:s.toFixed(6)]}),(0,a.jsxs)("div",{children:["Revealed At: ",l.revealedAt?new Date(l.revealedAt).toLocaleTimeString():"Not set"]}),(0,a.jsxs)("div",{children:["Escaped Players: ",(null===(n=l.escapedPlayers)||void 0===n?void 0:n.length)||0]})]}):null})()})]}),U.skillchecks&&U.skillchecks.length>0&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"text-xs text-yellow-700 mb-1",children:"Complete Skillchecks:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:U.skillchecks.map((e,t)=>(0,a.jsxs)("button",{onClick:async()=>{if(!e.isCompleted){console.log("\uD83D\uDEE0️ DEBUG: Completing skillcheck",e.id);let{completeSkillcheck:t}=await Promise.resolve().then(s.bind(s,4208));await t(U.id,e.id,P.id,!0),console.log("\uD83D\uDEE0️ DEBUG: Skillcheck completion request sent")}},disabled:e.isCompleted,className:"px-2 py-1 text-xs rounded ".concat(e.isCompleted?"bg-green-200 text-green-800":"bg-yellow-200 text-yellow-800 hover:bg-yellow-300"),children:["SC",t+1," ",e.isCompleted&&"✓"]},e.id))})]}),!(U.escapearea||U.escapeArea)&&(e$||"active"===U.status)&&(0,a.jsx)("button",{onClick:async()=>{console.log("\uD83D\uDEE0️ DEBUG: Force revealing escape area");let{revealEscapeAreaOnTimer:e}=await Promise.resolve().then(s.bind(s,4208));await e(U.id),console.log("\uD83D\uDEE0️ DEBUG: Escape area reveal request sent")},className:"w-full mb-2 px-3 py-2 bg-purple-200 text-purple-800 text-xs rounded hover:bg-purple-300",children:"\uD83D\uDEAA Force Reveal Escape Area"}),(0,a.jsxs)("div",{className:"text-xs bg-gray-100 p-2 rounded mb-2 text-black",children:[(0,a.jsx)("div",{className:"font-bold mb-1",children:"Map Debug:"}),(0,a.jsxs)("div",{children:["escapeArea prop: ",U.escapeArea?"Present":"Missing"]}),(0,a.jsxs)("div",{children:["Map visibility: ",ec?"Visible":"Hidden"]}),(0,a.jsxs)("div",{children:["Current role: ",(null==eB?void 0:eB.role)||"unknown"]}),(0,a.jsxs)("div",{children:["Is eliminated: ",(null==eB?void 0:eB.isAlive)===!1?"Yes":"No"]}),U.escapeArea&&(null==eB?void 0:eB.role)==="survivor"&&(0,a.jsx)("div",{className:"mt-1 pt-1 border-t border-gray-300",children:(0,a.jsxs)("div",{children:["Should see escape area: ",!U.escapeArea.isRevealed||(null==eB?void 0:eB.role)!=="survivor"&&(null==eB?void 0:eB.isAlive)?"NO":"YES"]})})]}),((null===(E=U.escapearea)||void 0===E?void 0:E.isRevealed)||(null===(A=U.escapeArea)||void 0===A?void 0:A.isRevealed))&&(0,a.jsx)("button",{onClick:async()=>{console.log("\uD83D\uDEE0️ DEBUG: Force escaping player");let{markPlayerEscaped:e}=await Promise.resolve().then(s.bind(s,4208));await e(U.id,P.id,!0),console.log("\uD83D\uDEE0️ DEBUG: Force escape request sent")},className:"w-full mb-2 px-3 py-2 bg-purple-300 text-purple-800 text-xs rounded hover:bg-purple-400",children:"\uD83C\uDFC3 Force Escape (Host)"}),(0,a.jsx)("button",{onClick:async()=>{console.log("\uD83D\uDEE0️ DEBUG: Manually checking game end");let{checkGameEnd:e}=await Promise.resolve().then(s.bind(s,4208));await e(U.id),console.log("\uD83D\uDEE0️ DEBUG: Game end check completed")},className:"w-full mb-2 px-3 py-2 bg-red-300 text-red-800 text-xs rounded hover:bg-red-400",children:"\uD83C\uDFC1 Force Check Game End"}),U.escape_timer_started_at&&(0,a.jsx)("button",{onClick:async()=>{let{checkEscapeTimerExpired:e}=await Promise.resolve().then(s.bind(s,4208));await e(U.id)},className:"w-full mb-2 px-3 py-2 bg-red-200 text-red-800 text-xs rounded hover:bg-red-300",children:"⏰ Force Timer Expiration"}),(0,a.jsx)("button",{onClick:async()=>{let{checkGameEnd:e}=await Promise.resolve().then(s.bind(s,4208));await e(U.id)},className:"w-full px-3 py-2 bg-gray-200 text-gray-800 text-xs rounded hover:bg-gray-300",children:"\uD83C\uDFAF Force Check Game End"})]}),eR&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-[60] pointer-events-none",children:(0,a.jsx)("div",{className:"glass-modal max-w-sm w-full mx-4 text-center animate-slide-up pointer-events-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"text-6xl mb-4 animate-bounce",children:"✅"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-granny-success mb-2",children:"Skillcheck Complete!"}),(0,a.jsx)("p",{className:"text-granny-text-muted text-sm",children:"Great timing! Keep it up."}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"w-full bg-granny-surface rounded-full h-2 overflow-hidden",children:(0,a.jsx)("div",{className:"bg-gradient-to-r from-granny-success/60 to-granny-success h-2 rounded-full animate-pulse"})})})]})})})]})}let C=(0,r.memo)(function(e){var t,s;let{player:n,onClick:l,canClick:i}=e,o=(0,r.useCallback)(()=>{i&&n.location&&l&&l(n.uid)},[i,n.location,n.uid,l]),c=(0,r.useMemo)(()=>{let e=!n.isAlive||n.hasEscaped,t="killer"===n.role?"granny-danger":"granny-survivor";return{container:"glass-card p-4 border transition-all duration-200 ".concat(e?"border-granny-text-muted/30 bg-granny-text-muted/10 opacity-75":"border-".concat(t,"/30 hover:border-").concat(t,"/50")," ").concat(i&&n.location?"cursor-pointer hover:scale-[1.02]":""),name:"font-semibold text-granny-text ".concat(e?"line-through opacity-75":"")}},[n.isAlive,n.hasEscaped,n.role,i,n.location]),d=(0,r.useMemo)(()=>n.hasEscaped&&n.escapedAt?{type:"escaped",time:new Date(n.escapedAt).toLocaleTimeString()}:!n.isAlive&&n.eliminatedAt?{type:"eliminated",time:new Date(n.eliminatedAt).toLocaleTimeString()}:null,[n.eliminatedAt,n.escapedAt,n.hasEscaped,n.isAlive]);return(0,a.jsxs)("div",{className:c.container,onClick:o,children:[n.profilePictureUrl?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:n.profilePictureUrl,alt:n.displayName,className:"w-12 h-12 rounded-full object-cover border-2 ".concat("killer"===n.role?"border-granny-danger/50":"border-granny-survivor/50")}),n.hasEscaped&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-granny-success rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs",children:"\uD83C\uDF89"})}),!n.isAlive&&!n.hasEscaped&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-granny-error rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs",children:"\uD83D\uDC80"})})]}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full border-2 flex items-center justify-center ".concat("killer"===n.role?"bg-granny-danger/20 border-granny-danger/50":"bg-granny-survivor/20 border-granny-survivor/50"),children:(0,a.jsx)("span",{className:"text-lg font-bold text-granny-text",children:null===(t=n.displayName[0])||void 0===t?void 0:t.toUpperCase()})}),n.hasEscaped&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-granny-success rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs",children:"\uD83C\uDF89"})}),!n.isAlive&&!n.hasEscaped&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-granny-error rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs",children:"\uD83D\uDC80"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:c.name,children:n.displayName}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsxs)("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat("killer"===n.role?"bg-granny-danger/20 text-granny-danger":"bg-granny-survivor/20 text-granny-survivor"),children:["killer"===n.role?"\uD83D\uDD2A":"\uD83D\uDEE1️"," ",null===(s=n.role)||void 0===s?void 0:s.toUpperCase()]}),n.hasEscaped&&(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-granny-success/20 text-granny-success",children:"\uD83C\uDF89 ESCAPED"}),!n.isAlive&&!n.hasEscaped&&(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full bg-granny-error/20 text-granny-error",children:"\uD83D\uDC80 ELIMINATED"})]}),d&&(0,a.jsxs)("p",{className:"text-xs text-granny-text-muted mt-1 flex items-center gap-1",children:["⏰ ","escaped"===d.type?"Escaped":"Eliminated"," at ",d.time]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[n.hasEscaped&&(0,a.jsx)("div",{className:"text-3xl animate-bounce",children:"\uD83C\uDF89"}),!n.isAlive&&!n.hasEscaped&&(0,a.jsx)("div",{className:"text-2xl text-granny-error",children:"\uD83D\uDC80"}),n.isAlive&&!n.hasEscaped&&(0,a.jsx)("div",{className:"text-2xl ".concat("killer"===n.role?"text-granny-danger":"text-granny-survivor"),children:"killer"===n.role?"\uD83D\uDD2A":"\uD83D\uDEE1️"})]})]})});function A(e){let{params:t}=e;return(0,a.jsx)(d.Z,{fallback:(0,a.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,a.jsx)("p",{children:"Please sign in to access this game."})}),children:(0,a.jsx)(E,{params:t})})}}},function(e){e.O(0,[733,212,34,712,689,971,23,744],function(){return e(e.s=5292)}),_N_E=e.O()}]);
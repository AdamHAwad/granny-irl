(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{325:function(e,t,n){Promise.resolve().then(n.bind(n,6551))},6551:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var r=n(7437),s=n(2265),a=n(6463),l=n(857),i=n(716);function o(){let{signInWithGoogle:e}=(0,l.a)();return(0,r.jsxs)("button",{onClick:e,className:"glass-card hover:bg-granny-surface-light text-granny-text font-semibold py-4 px-6 flex items-center justify-center gap-3 transition-all duration-200 hover:shadow-lg hover:shadow-granny-danger/10 group w-full",children:[(0,r.jsxs)("svg",{className:"w-5 h-5 transition-transform group-hover:scale-110",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{className:"text-lg",children:"Sign in with Google"})]})}var c=n(4660),d=n(5347);function u(e){var t,n,a,i,o,c;let{onComplete:u,existingProfile:x}=e,{user:m}=(0,l.a)(),[g,h]=(0,s.useState)(""),[f,p]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{x&&(h(x.custom_username||""),x.profile_picture_url&&v(x.profile_picture_url))},[x]);let N=async e=>{if(e.preventDefault(),m){j(!0);try{console.log("ProfileSetup: Starting profile update for user:",m.id),f&&(console.log("ProfileSetup: Uploading profile picture..."),await (0,d.ow)(m.id,f),console.log("ProfileSetup: Profile picture uploaded successfully")),g.trim()&&(console.log("ProfileSetup: Updating username to:",g.trim()),await (0,d.Lj)(m.id,{custom_username:g.trim()}),console.log("ProfileSetup: Username updated successfully")),console.log("ProfileSetup: Profile setup completed successfully"),u()}catch(e){console.error("Error updating profile:",e),alert("Error updating profile: ".concat(e))}finally{j(!1)}}},w=async()=>{if(m){j(!0);try{await (0,d.sx)(m.id),p(null),v(null),console.log("Profile picture removed successfully")}catch(e){console.error("Error removing profile picture:",e),alert("Error removing profile picture: ".concat(e))}finally{j(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,r.jsx)("div",{className:"glass-modal max-w-md w-full text-granny-text animate-slide-up",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-granny-text mb-2 flex items-center justify-center gap-2",children:"\uD83D\uDC64 Complete Your Profile"}),(0,r.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Customize your identity for the hunt"})]}),(0,r.jsxs)("form",{onSubmit:N,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mb-6",children:b?(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{src:b,alt:"Profile preview",className:"w-28 h-28 rounded-full mx-auto object-cover border-4 border-granny-survivor/50 shadow-lg"}),(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-transparent to-granny-bg/20 pointer-events-none"})]}):(0,r.jsx)("div",{className:"w-28 h-28 rounded-full mx-auto bg-granny-surface border-4 border-granny-border/50 flex items-center justify-center shadow-lg",children:(0,r.jsx)("span",{className:"text-3xl text-granny-text-muted font-bold",children:(null==m?void 0:null===(a=m.user_metadata)||void 0===a?void 0:null===(n=a.full_name)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.toUpperCase())||(null==m?void 0:null===(o=m.email)||void 0===o?void 0:null===(i=o[0])||void 0===i?void 0:i.toUpperCase())})})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("label",{className:"block",children:[(0,r.jsx)("span",{className:"text-sm font-semibold text-granny-text mb-3 block flex items-center gap-2 justify-center",children:"\uD83D\uDCF8 Profile Picture (optional)"}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(p(n),v(URL.createObjectURL(n)))},className:"block w-full text-sm text-granny-text-muted file:mr-4 file:py-3 file:px-6 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-granny-surface file:text-granny-text file:border file:border-granny-border hover:file:bg-granny-surface-light file:transition-all file:duration-200 bg-granny-surface border border-granny-border rounded-lg focus:border-granny-survivor/50 focus:ring-2 focus:ring-granny-survivor/20 transition-all duration-200",disabled:y})})]}),(b||f)&&(0,r.jsx)("button",{type:"button",onClick:w,disabled:y,className:"text-sm text-granny-error hover:text-granny-error/80 font-medium disabled:opacity-50 transition-colors duration-200 flex items-center gap-1 mx-auto",children:"\uD83D\uDDD1️ Remove Picture"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3 flex items-center gap-2",children:"✏️ Custom Username (optional)"}),(0,r.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Default: ".concat((null==m?void 0:null===(c=m.user_metadata)||void 0===c?void 0:c.full_name)||(null==m?void 0:m.email)),className:"input-field w-full placeholder:text-granny-text-muted/60",maxLength:20}),(0,r.jsx)("p",{className:"text-xs text-granny-text-muted mt-3 flex items-center gap-1",children:"\uD83D\uDC65 This will be displayed to other players during games"})]}),(0,r.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{u()},className:"btn-ghost flex-1 py-3",disabled:y,children:"Skip for Now"}),(0,r.jsx)("button",{type:"submit",className:"btn-secondary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:y,children:y?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Saving..."})]}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDCBE Save Profile"})})]})]})]})})})}var x=n(4208),m=n(6976),g=n(7818),h=n(556);n(966);let f=(0,g.default)(()=>n.e(113).then(n.bind(n,1376)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),p=(0,g.default)(()=>n.e(113).then(n.bind(n,1376)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),b=(0,g.default)(()=>n.e(113).then(n.bind(n,1376)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[1376]},ssr:!1});function v(e){let{isOpen:t,onClose:a,onRoomCreated:o}=e,{user:c}=(0,l.a)(),{profile:d}=(0,i.G)(),[u,g]=(0,s.useState)(!1),[v,y]=(0,s.useState)({killerCount:1,roundLengthMinutes:15,headstartMinutes:3,maxPlayers:15}),[j,N]=(0,s.useState)(!0),[w,D]=(0,s.useState)(3),[C,k]=(0,s.useState)(200),[S,_]=(0,s.useState)(null),[P,E]=(0,s.useState)(!1),[R,F]=(0,s.useState)([37.7749,-122.4194]),[A,U]=(0,s.useState)(""),[L,z]=(0,s.useState)(null),M=()=>{let e=n(7691);return delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"}),{pinIcon:new e.Icon({iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),createProfileIcon:(t,n)=>{var r;let s=(null===(r=n[0])||void 0===r?void 0:r.toUpperCase())||"U";return new e.DivIcon({html:t?'<div style="width: 40px; height: 40px; border-radius: 50%; border: 3px solid #3B82F6; overflow: hidden; background-color: white;">\n               <img src="'.concat(t,'" alt="Your location" style="width: 100%; height: 100%; object-fit: cover;" />\n             </div>'):'<div style="width: 40px; height: 40px; border-radius: 50%; border: 3px solid #3B82F6; background-color: #9CA3AF; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; font-weight: bold;">\n               '.concat(s,"\n             </div>"),className:"profile-marker",iconSize:[40,40],iconAnchor:[20,20]})}}};(0,s.useEffect)(()=>{P&&m.E1.getCurrentLocation().then(e=>{F([e.latitude,e.longitude]),z(e)}).catch(()=>{})},[P]);let I=async e=>{if(e.preventDefault(),c&&d){g(!0);try{if(console.log("CreateRoom: Starting room creation for user:",c.id),console.log("CreateRoom: Profile data:",d),!S){U("Please pin a location for skillcheck placement"),g(!1);return}let e={...v,skillchecks:{enabled:!0,count:w,maxDistanceFromHost:C}};console.log("CreateRoom: Settings:",e);let t=await (0,x.createRoom)(c.id,{displayName:d.custom_username||d.display_name,profilePictureUrl:d.profile_picture_url},e,S||void 0);console.log("CreateRoom: Room created successfully with code:",t),o(t)}catch(t){console.error("Error creating room:",t),console.error("Error details:",t);let e=(null==t?void 0:t.message)||"Failed to create room. Please try again.";alert("Error: ".concat(e))}finally{g(!1)}}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-start justify-center p-4 z-50 overflow-y-auto",children:(0,r.jsxs)("div",{className:"glass-modal w-full max-w-lg text-granny-text my-8 max-h-[90vh] flex flex-col animate-slide-up",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-6 pb-4 border-b border-granny-border/30",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-granny-text mb-1",children:"\uD83C\uDFAE Create Room"}),(0,r.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Configure your horror game session"})]}),(0,r.jsx)("button",{onClick:a,className:"text-granny-text-muted hover:text-granny-text text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-granny-surface-light transition-colors",children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:I,className:"p-6 space-y-6 overflow-y-auto flex-1",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3 flex items-center gap-2",children:"\uD83D\uDD2A Number of Killers"}),(0,r.jsxs)("select",{value:v.killerCount,onChange:e=>y({...v,killerCount:parseInt(e.target.value)}),className:"input-field w-full",children:[(0,r.jsx)("option",{value:1,children:"1 Killer"}),(0,r.jsx)("option",{value:2,children:"2 Killers"}),(0,r.jsx)("option",{value:3,children:"3 Killers"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3 flex items-center gap-2",children:"⏱️ Round Length"}),(0,r.jsxs)("select",{value:v.roundLengthMinutes,onChange:e=>y({...v,roundLengthMinutes:parseFloat(e.target.value)}),className:"input-field w-full",children:[(0,r.jsx)("option",{value:.5,children:"30 seconds (testing)"}),(0,r.jsx)("option",{value:5,children:"5 minutes"}),(0,r.jsx)("option",{value:10,children:"10 minutes"}),(0,r.jsx)("option",{value:15,children:"15 minutes"}),(0,r.jsx)("option",{value:20,children:"20 minutes"}),(0,r.jsx)("option",{value:30,children:"30 minutes"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3 flex items-center gap-2",children:"\uD83C\uDFC3 Headstart Time"}),(0,r.jsxs)("select",{value:v.headstartMinutes,onChange:e=>y({...v,headstartMinutes:parseFloat(e.target.value)}),className:"input-field w-full",children:[(0,r.jsx)("option",{value:.083,children:"5 seconds (testing)"}),(0,r.jsx)("option",{value:1,children:"1 minute"}),(0,r.jsx)("option",{value:3,children:"3 minutes"}),(0,r.jsx)("option",{value:5,children:"5 minutes"})]}),(0,r.jsx)("p",{className:"text-xs text-granny-text-muted mt-2",children:"Time for survivors to hide before the hunt begins"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3 flex items-center gap-2",children:"\uD83D\uDC65 Max Players"}),(0,r.jsxs)("select",{value:v.maxPlayers,onChange:e=>y({...v,maxPlayers:parseInt(e.target.value)}),className:"input-field w-full",children:[(0,r.jsx)("option",{value:5,children:"5 players"}),(0,r.jsx)("option",{value:8,children:"8 players"}),(0,r.jsx)("option",{value:10,children:"10 players"}),(0,r.jsx)("option",{value:12,children:"12 players"}),(0,r.jsx)("option",{value:15,children:"15 players"})]})]}),(0,r.jsxs)("div",{className:"glass-card p-4 border border-granny-survivor/30 bg-granny-survivor/5",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-granny-survivor flex items-center gap-2",children:"\uD83C\uDFAF Skillcheck Configuration (Required)"}),(0,r.jsx)("p",{className:"text-xs text-granny-text-muted mt-1",children:"Survivors must complete objectives while avoiding killers"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[A&&(0,r.jsx)("div",{className:"bg-granny-error/10 border border-granny-error/30 rounded-lg p-3",children:(0,r.jsxs)("p",{className:"text-granny-error text-sm",children:["⚠️ ",A]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-3",children:"\uD83D\uDCCD Skillcheck Center Location"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>E(!P),className:"w-full p-4 rounded-lg border-2 text-left transition-all duration-200 ".concat(S?"border-granny-success/50 bg-granny-success/10 hover:bg-granny-success/15":"border-granny-border bg-granny-surface hover:bg-granny-surface-light"),children:S?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-granny-success font-semibold mb-1",children:"\uD83D\uDCCD Location Selected"}),(0,r.jsxs)("div",{className:"text-xs text-granny-text-muted",children:[S.latitude.toFixed(6),", ",S.longitude.toFixed(6)]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-granny-text font-semibold mb-1",children:"\uD83D\uDDFA️ Click to Pin Location"}),(0,r.jsx)("div",{className:"text-xs text-granny-text-muted",children:"Choose where skillchecks will be centered around"})]})}),P&&(0,r.jsxs)("div",{className:"border border-granny-border rounded-lg overflow-hidden bg-granny-surface",children:[(0,r.jsx)("div",{style:{height:"200px",width:"100%"},children:(0,r.jsxs)(f,{center:R,zoom:13,style:{height:"100%",width:"100%"},children:[(0,r.jsx)(p,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,r.jsx)(e=>{let{onLocationSelect:t}=e;return(0,h.zV)({click:e=>{let{lat:n,lng:r}=e.latlng;t({latitude:n,longitude:r})}}),null},{onLocationSelect:e=>{_(e),U("")}}),L&&d&&(()=>{let e=M();return e?(0,r.jsx)(b,{position:[L.latitude,L.longitude],icon:e.createProfileIcon(d.profile_picture_url||null,d.custom_username||d.display_name||"User")}):null})(),S&&(()=>{let e=M();return e?(0,r.jsx)(b,{position:[S.latitude,S.longitude],icon:e.pinIcon}):null})()]})}),(0,r.jsxs)("div",{className:"bg-granny-surface-light p-3 text-xs text-granny-text-muted border-t border-granny-border",children:[(0,r.jsx)("p",{className:"mb-1",children:"\uD83D\uDD35 Blue marker = Your current location (reference)"}),(0,r.jsx)("p",{children:"\uD83D\uDCCD Red pin = Click anywhere to set skillcheck center"})]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-granny-text mb-3",children:["\uD83C\uDFAF Number of Skillchecks: ",(0,r.jsx)("span",{className:"text-granny-danger",children:w})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"8",step:"1",value:w,onChange:e=>D(parseInt(e.target.value)),className:"w-full h-2 bg-granny-surface rounded-lg appearance-none cursor-pointer slider",style:{background:"linear-gradient(to right, #c41e3a 0%, #c41e3a ".concat((w-1)/7*100,"%, #1a1a1d ").concat((w-1)/7*100,"%, #1a1a1d 100%)")}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-granny-text-muted mt-2",children:[(0,r.jsx)("span",{children:"1 objective"}),(0,r.jsx)("span",{children:"8 objectives"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-semibold text-granny-text mb-3",children:["\uD83D\uDCCF Max Distance: ",(0,r.jsxs)("span",{className:"text-granny-survivor",children:[C,"m"]})]}),(0,r.jsx)("input",{type:"range",min:"50",max:"1000",step:"25",value:C,onChange:e=>k(parseInt(e.target.value)),className:"w-full h-2 bg-granny-surface rounded-lg appearance-none cursor-pointer slider",style:{background:"linear-gradient(to right, #2d5a3d 0%, #2d5a3d ".concat((C-50)/950*100,"%, #1a1a1d ").concat((C-50)/950*100,"%, #1a1a1d 100%)")}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-granny-text-muted mt-2",children:[(0,r.jsx)("span",{children:"50m (tight)"}),(0,r.jsx)("span",{children:"1000m (spread)"})]}),(0,r.jsx)("p",{className:"text-xs text-granny-text-muted mt-2",children:"Objectives randomly scattered within this radius from center"})]}),(0,r.jsxs)("div",{className:"glass-card p-4 border border-granny-warning/30",children:[(0,r.jsx)("h4",{className:"font-semibold text-granny-warning mb-2 text-sm flex items-center gap-2",children:"\uD83D\uDCCB Skillcheck Rules:"}),(0,r.jsxs)("ul",{className:"text-xs text-granny-text-muted space-y-1",children:[(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-granny-danger",children:"•"})," Complete ALL objectives + survive timer"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-granny-danger",children:"•"})," 30s timing challenge per objective"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-granny-survivor",children:"•"})," Co-op: survivors can work together"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-granny-survivor",children:"•"})," Hidden from killer maps"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-granny-warning",children:"•"})," Unlock escape area when complete"]})]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-4 p-6 pt-4 border-t border-granny-border/30",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"btn-ghost flex-1 py-3",disabled:u,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",onClick:I,className:"btn-primary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:u?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Creating..."})]}):(0,r.jsx)(r.Fragment,{children:"\uD83C\uDFAE Create Room"})})]})]})}):null}function y(e){let{isOpen:t,onClose:n,onRoomJoined:a}=e,{user:o}=(0,l.a)(),{profile:c}=(0,i.G)(),[d,u]=(0,s.useState)(""),[m,g]=(0,s.useState)(!1),[h,f]=(0,s.useState)(""),p=async e=>{if(e.preventDefault(),!o||!c)return;let t=d.trim().toUpperCase();if(6!==t.length){f("Room code must be 6 characters");return}g(!0),f("");try{if(!await (0,x.joinRoom)(t,o.id,{displayName:c.custom_username||c.display_name,profilePictureUrl:c.profile_picture_url})){f("Room not found");return}a(t)}catch(e){f(e.message||"Failed to join room")}finally{g(!1)}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"glass-modal p-8 w-full max-w-md text-granny-text animate-slide-up",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-granny-text mb-1",children:"\uD83D\uDEAA Join Room"}),(0,r.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Enter the 6-digit room code"})]}),(0,r.jsx)("button",{onClick:n,className:"text-granny-text-muted hover:text-granny-text text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-granny-surface-light transition-colors",children:"\xd7"})]}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-semibold text-granny-text mb-4 flex items-center gap-2",children:"\uD83D\uDD11 Room Code"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",value:d,onChange:e=>{u(e.target.value.toUpperCase().slice(0,6)),f("")},placeholder:"ABC123",className:"w-full px-6 py-4 bg-granny-surface border-2 border-granny-border text-granny-text placeholder-granny-text-muted rounded-xl focus:outline-none focus:border-granny-survivor/50 focus:ring-2 focus:ring-granny-survivor/20 text-center text-3xl font-mono tracking-[0.3em] font-bold transition-all duration-200",maxLength:6,autoComplete:"off"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-granny-survivor/5 to-transparent pointer-events-none rounded-xl"})]}),(0,r.jsx)("p",{className:"text-sm text-granny-text-muted mt-3 text-center",children:"Ask the host for the room code to join the hunt"})]}),h&&(0,r.jsx)("div",{className:"glass-card p-4 border border-granny-error/30 bg-granny-error/10",children:(0,r.jsxs)("p",{className:"text-granny-error text-sm font-medium flex items-center gap-2",children:["⚠️ ",h]})}),(0,r.jsxs)("div",{className:"flex gap-4 pt-6",children:[(0,r.jsx)("button",{type:"button",onClick:n,className:"btn-ghost flex-1 py-3",disabled:m,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"btn-secondary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",disabled:m||6!==d.length,children:m?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Joining..."})]}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDEAA Join Room"})})]})]})]})}):null}function j(){let{user:e}=(0,l.a)(),t=(0,a.useRouter)(),[n,i]=(0,s.useState)([]),[o,c]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{if(!e){c(!1);return}let t=async()=>{try{let t=await (0,x.getCurrentUserRooms)(e.id);i(t)}catch(e){console.error("Error fetching current rooms:",e)}finally{c(!1)}};t();let n=setInterval(t,5e3);return()=>clearInterval(n)},[e]),o||!e||0===n.length)return null;let d=e=>{"waiting"===e.status?t.push("/room/".concat(e.id)):("headstart"===e.status||"active"===e.status)&&t.push("/game/".concat(e.id))},u=e=>{switch(e){case"waiting":return"bg-granny-survivor/20 text-granny-survivor border border-granny-survivor/50";case"headstart":return"bg-granny-warning/20 text-granny-warning border border-granny-warning/50";case"active":return"bg-granny-danger/20 text-granny-danger border border-granny-danger/50";default:return"bg-granny-surface text-granny-text-muted border border-granny-border/50"}},m=e=>{switch(e){case"waiting":return"⏳ Waiting for Players";case"headstart":return"\uD83C\uDFC3 Headstart Phase";case"active":return"\uD83D\uDD25 Game Active";default:return e}},g=e=>{switch(e){case"waiting":return"\uD83C\uDFE0";case"headstart":return"⚡";case"active":return"\uD83D\uDC80";default:return"\uD83C\uDFAE"}};return(0,r.jsxs)("div",{className:"w-full max-w-md mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4 text-granny-text flex items-center gap-2",children:"\uD83C\uDFAE Your Active Games"}),(0,r.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,r.jsxs)("div",{onClick:()=>d(e),className:"glass-card border border-granny-border/30 hover:border-granny-border/50 p-4 cursor-pointer transition-all duration-200 hover:scale-[1.02] group",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-bold text-lg text-granny-text flex items-center gap-2 group-hover:text-granny-survivor transition-colors",children:[g(e.status)," Room ",e.id]}),(0,r.jsxs)("p",{className:"text-sm text-granny-text-muted flex items-center gap-1",children:["\uD83D\uDC65 ",Object.keys(e.players).length,"/",e.settings.maxPlayers," players"]})]}),(0,r.jsx)("span",{className:"px-3 py-1 rounded-lg text-xs font-semibold ".concat(u(e.status)," animate-pulse"),children:m(e.status)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs text-granny-text-muted mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-granny-danger",children:"\uD83D\uDD2A"}),(0,r.jsxs)("span",{children:[e.settings.killerCount," killer",e.settings.killerCount>1?"s":""]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-granny-warning",children:"⏱️"}),(0,r.jsxs)("span",{children:[e.settings.roundLengthMinutes,"m round"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-granny-survivor",children:"\uD83C\uDFC3"}),(0,r.jsxs)("span",{children:[e.settings.headstartMinutes,"m start"]})]})]}),"waiting"!==e.status&&(0,r.jsx)("div",{className:"mt-3 pt-3 border-t border-granny-border/20",children:(0,r.jsx)("div",{className:"text-xs text-granny-warning font-medium flex items-center gap-1 animate-pulse",children:"⚡ Click to rejoin the hunt →"})})]},e.id))})]})}var N=n(6892);function w(){var e,t,n;let{user:o,logout:c}=(0,l.a)(),{profile:d,loading:x,needsSetup:g,setNeedsSetup:h,refreshProfile:f}=(0,i.G)(),p=(0,a.useRouter)(),[b,w]=(0,s.useState)(!1),[D,C]=(0,s.useState)(!1),[k,S]=(0,s.useState)(!1),[_,P]=(0,s.useState)(!1),[E,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{x||g||!d||_||F()},[x,g,d,_]);let F=async()=>{try{if(!m.E1.isSupported()){P(!0);return}await m.E1.getCurrentLocation(),R(!0),P(!0)}catch(e){S(!0),P(!0)}};if(x)return(0,r.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"glass-card p-8 text-center",children:[(0,r.jsx)("div",{className:"text-lg text-granny-text mb-4",children:"Loading profile..."}),(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-granny-danger border-t-transparent rounded-full animate-spin mx-auto"})]})});if(g)return(0,r.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4",children:(0,r.jsx)("div",{className:"glass-modal p-8 max-w-md w-full animate-slide-up",children:(0,r.jsx)(u,{existingProfile:d,onComplete:()=>{h(!1),f()}})})});let A=(null==d?void 0:d.custom_username)||(null==d?void 0:d.display_name)||(null==o?void 0:null===(e=o.user_metadata)||void 0===e?void 0:e.full_name)||(null==o?void 0:null===(t=o.email)||void 0===t?void 0:t.split("@")[0])||"User";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/80 to-granny-bg"}),(0,r.jsxs)("div",{className:"glass-card p-8 text-center mb-8 max-w-lg w-full animate-slide-up relative z-10",children:[(0,r.jsx)("div",{className:"mb-6",children:(null==d?void 0:d.profile_picture_url)?(0,r.jsx)("img",{src:d.profile_picture_url,alt:"Profile",className:"w-20 h-20 rounded-full mx-auto object-cover border-3 border-granny-border shadow-lg"}):(0,r.jsx)("div",{className:"w-20 h-20 rounded-full mx-auto bg-granny-surface flex items-center justify-center border-3 border-granny-border shadow-lg",children:(0,r.jsx)("span",{className:"text-2xl text-granny-text font-semibold",children:null==A?void 0:null===(n=A[0])||void 0===n?void 0:n.toUpperCase()})})}),(0,r.jsx)("h1",{className:"text-4xl font-bold mb-3 text-granny-text",children:"Granny IRL"}),(0,r.jsx)("div",{className:"w-12 h-1 bg-gradient-to-r from-granny-danger to-granny-survivor mx-auto mb-4 rounded-full"}),(0,r.jsxs)("p",{className:"text-xl mb-6 text-granny-text font-medium",children:["Welcome back, ",(0,r.jsx)("span",{className:"text-granny-danger",children:A}),"!"]}),_&&(0,r.jsx)("div",{className:"mb-6 px-4 py-3 rounded-lg text-sm glass-card ".concat(E?"border-granny-success/30":"border-granny-warning/30"),children:E?(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-granny-success",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCD"}),(0,r.jsx)("span",{className:"font-medium",children:"Location enabled - ready for enhanced gameplay!"})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-granny-warning",children:[(0,r.jsx)("span",{children:"\uD83D\uDCCD"}),(0,r.jsxs)("span",{children:["Location disabled -",(0,r.jsx)("button",{onClick:()=>S(!0),className:"underline hover:no-underline font-semibold ml-1",children:"click to enable"})," for enhanced features"]})]})}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 justify-center text-sm",children:[(0,r.jsx)("button",{onClick:()=>h(!0),className:"text-granny-danger hover:text-granny-danger/80 underline hover:no-underline transition-all font-medium",children:"Edit Profile"}),(0,r.jsx)("button",{onClick:()=>p.push("/history"),className:"text-granny-survivor hover:text-granny-survivor/80 underline hover:no-underline transition-all font-medium",children:"Game History"}),(0,r.jsx)("button",{onClick:c,className:"text-granny-text-muted hover:text-granny-text underline hover:no-underline transition-all font-medium",children:"Sign out"})]})]}),(0,r.jsx)("div",{className:"w-full max-w-lg mb-8",children:(0,r.jsx)(j,{})}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 w-full max-w-lg relative z-10",children:[(0,r.jsx)("button",{onClick:()=>w(!0),className:"btn-primary flex-1 text-lg font-semibold animate-glow",children:"\uD83C\uDFAE Create Room"}),(0,r.jsx)("button",{onClick:()=>C(!0),className:"btn-secondary flex-1 text-lg font-semibold",children:"\uD83D\uDEAA Join Room"})]})]}),(0,r.jsx)(v,{isOpen:b,onClose:()=>w(!1),onRoomCreated:e=>{w(!1),p.push("/room/".concat(e))}}),(0,r.jsx)(y,{isOpen:D,onClose:()=>C(!1),onRoomJoined:e=>{C(!1),p.push("/room/".concat(e))}}),(0,r.jsx)(N.Z,{isOpen:k,onPermissionGranted:()=>{R(!0),S(!1)},onPermissionDenied:e=>{console.log("Location permission denied:",e),S(!1)},onSkip:()=>{S(!1)}})]})}function D(){return(0,r.jsxs)("main",{className:"flex min-h-screen flex-col items-center justify-center p-4 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-granny-bg/50 to-granny-bg"}),(0,r.jsxs)("div",{className:"glass-card p-8 text-center max-w-md w-full animate-slide-up relative z-10",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-5xl font-bold mb-4 text-granny-text bg-gradient-to-r from-granny-danger to-granny-survivor bg-clip-text text-transparent animate-float",children:"Granny IRL"}),(0,r.jsx)("div",{className:"w-16 h-1 bg-gradient-to-r from-granny-danger to-granny-survivor mx-auto mb-6 rounded-full"})]}),(0,r.jsx)("p",{className:"text-xl mb-4 text-granny-text font-medium",children:"Real-life horror tag"}),(0,r.jsx)("p",{className:"text-granny-text-muted mb-8 leading-relaxed",children:"Outdoor multiplayer game with GPS tracking, skillchecks, and escape mechanics"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(o,{}),(0,r.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Sign in with Google to start playing"})]})]}),(0,r.jsx)("div",{className:"absolute top-20 left-20 w-2 h-2 bg-granny-danger/30 rounded-full animate-pulse"}),(0,r.jsx)("div",{className:"absolute bottom-32 right-24 w-3 h-3 bg-granny-survivor/20 rounded-full animate-pulse delay-1000"}),(0,r.jsx)("div",{className:"absolute top-1/3 right-20 w-1 h-1 bg-granny-warning/40 rounded-full animate-pulse delay-500"})]})}function C(){return(0,r.jsx)(c.Z,{fallback:(0,r.jsx)(D,{}),children:(0,r.jsx)(w,{})})}},670:function(e,t,n){"use strict";n.d(t,{Hb:function(){return s},UO:function(){return i},mE:function(){return o},sj:function(){return a}});var r=n(2265);function s(e){return Object.freeze({__version:1,map:e})}function a(e,t){return Object.freeze({...e,...t})}let l=(0,r.createContext)(null),i=l.Provider;function o(){let e=(0,r.useContext)(l);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},556:function(e,t,n){"use strict";n.d(t,{$_:function(){return l},Sx:function(){return a},zV:function(){return i}});var r=n(670),s=n(2265);function a(){return(0,r.mE)().map}function l(e,t){let n=a();return(0,s.useEffect)(function(){return n.on(e,t),function(){n.off(e,t)}},[n,e,t]),n}function i(e){let t=a();return(0,s.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}}},function(e){e.O(0,[733,212,34,712,689,971,23,744],function(){return e(e.s=325)}),_N_E=e.O()}]);
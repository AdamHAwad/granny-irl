(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[689],{6892:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(7437),i=r(2265),o=r(6976);function a(e){let{isOpen:t,onPermissionGranted:r,onPermissionDenied:a,onSkip:s}=e,[l,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(null),g=(0,i.useCallback)(async()=>{if(!o.E1.isSupported()){u({granted:!1,denied:!0,prompt:!1,error:"Location services are not supported on this device"});return}try{await o.E1.getCurrentLocation(),u({granted:!0,denied:!1,prompt:!1}),r()}catch(e){u({granted:!1,denied:!1,prompt:!0})}},[]);(0,i.useEffect)(()=>{t&&!d&&g()},[t,d,g]);let p=async()=>{c(!0);try{let e=await o.E1.requestPermission();u(e),e.granted?r():a(e.error||"Location permission denied")}catch(t){let e="Failed to request location permission";u({granted:!1,denied:!0,prompt:!1,error:e}),a(e)}finally{c(!1)}},f=()=>{null==s||s()};return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,n.jsx)("div",{className:"glass-modal max-w-md w-full text-granny-text animate-slide-up",children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"text-center mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-granny-text mb-2 flex items-center justify-center gap-2",children:"\uD83D\uDCCD Location Access"}),(0,n.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Enhanced tracking for the ultimate horror experience"})]}),(null==d?void 0:d.granted)?(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"✅"}),(0,n.jsx)("div",{className:"text-granny-success text-lg font-semibold mb-4",children:"Location access granted!"}),(0,n.jsx)("p",{className:"text-sm text-granny-text-muted",children:"Your location will be shared with other players during the game for real-time hunting."})]}):(null==d?void 0:d.denied)?(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDEAB"}),(0,n.jsx)("div",{className:"text-granny-error text-lg font-semibold mb-4",children:"Location access denied"}),(0,n.jsx)("p",{className:"text-sm text-granny-text-muted mb-6",children:d.error||"Location permission is required for the enhanced gameplay experience."}),(0,n.jsxs)("div",{className:"glass-card p-4 border border-granny-warning/30 bg-granny-warning/10 mb-6",children:[(0,n.jsxs)("p",{className:"text-xs text-granny-warning font-medium",children:["\uD83D\uDEE0️ ",(0,n.jsx)("strong",{children:"To enable location access:"})]}),(0,n.jsxs)("div",{className:"text-xs text-granny-text-muted mt-2 space-y-1",children:[(0,n.jsx)("p",{children:"1. Click the location icon in your address bar"}),(0,n.jsx)("p",{children:'2. Select "Allow" for location permissions'}),(0,n.jsx)("p",{children:"3. Refresh the page and try again"})]})]}),s&&(0,n.jsx)("button",{onClick:f,className:"btn-ghost px-6 py-3",children:"Continue Without Location"})]}):(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsx)("div",{className:"text-4xl mb-3",children:"\uD83C\uDFAF"}),(0,n.jsx)("p",{className:"text-granny-text font-semibold mb-1",children:"Enhanced Gameplay Experience"}),(0,n.jsx)("p",{className:"text-xs text-granny-text-muted",children:"Real-time tracking for immersive horror gameplay"})]}),(0,n.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,n.jsx)("div",{className:"glass-card p-3 border border-granny-danger/20 bg-granny-danger/5",children:(0,n.jsxs)("p",{className:"text-sm text-granny-text flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-granny-danger",children:"\uD83D\uDD2A"}),(0,n.jsx)("strong",{children:"Killers"})," can track survivor locations on interactive maps"]})}),(0,n.jsx)("div",{className:"glass-card p-3 border border-granny-warning/20 bg-granny-warning/5",children:(0,n.jsxs)("p",{className:"text-sm text-granny-text flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-granny-warning",children:"⚠️"}),(0,n.jsx)("strong",{children:"Proximity alerts"})," when killers get dangerously close"]})}),(0,n.jsx)("div",{className:"glass-card p-3 border border-granny-survivor/20 bg-granny-survivor/5",children:(0,n.jsxs)("p",{className:"text-sm text-granny-text flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-granny-survivor",children:"\uD83E\uDDED"}),(0,n.jsx)("strong",{children:"Directional guidance"})," helps hunters track their prey"]})}),(0,n.jsx)("div",{className:"glass-card p-3 border border-granny-border/20",children:(0,n.jsxs)("p",{className:"text-sm text-granny-text flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-granny-text",children:"\uD83D\uDD12"}),(0,n.jsx)("strong",{children:"Privacy protected"})," - only shared during active hunts"]})})]})]}),(0,n.jsxs)("div",{className:"glass-card p-4 border border-granny-survivor/30 bg-granny-survivor/10 mb-6",children:[(0,n.jsx)("p",{className:"text-xs text-granny-survivor font-semibold mb-1",children:"\uD83D\uDD12 Privacy Guarantee"}),(0,n.jsx)("p",{className:"text-xs text-granny-text-muted",children:"Your location is only shared with other players during active games and is automatically cleared when games end. No tracking outside of gameplay sessions."})]}),(0,n.jsxs)("div",{className:"flex gap-4",children:[s&&(0,n.jsx)("button",{onClick:f,disabled:l,className:"btn-ghost flex-1 py-3 disabled:opacity-50",children:"Skip for Now"}),(0,n.jsx)("button",{onClick:p,disabled:l,className:"btn-secondary flex-1 py-3 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),(0,n.jsx)("span",{children:"Requesting..."})]}):(0,n.jsx)(n.Fragment,{children:"\uD83D\uDCCD Enable Location"})})]}),(0,n.jsx)("div",{className:"mt-4 text-xs text-granny-text-muted text-center",children:"\uD83D\uDCA1 You can change this permission anytime in your browser settings"})]})]})})}):null}},716:function(e,t,r){"use strict";r.d(t,{G:function(){return a}});var n=r(2265),i=r(857),o=r(5347);function a(){let{user:e}=(0,i.a)(),[t,r]=(0,n.useState)(null),[a,s]=(0,n.useState)(!0),[l,c]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!e){r(null),s(!1);return}(async()=>{try{console.log("useUserProfile: Loading profile for user:",e.id),console.log("useUserProfile: User metadata:",e.user_metadata);let t=await (0,o.et)(e.id);console.log("useUserProfile: Existing profile found:",t),t||(console.log("useUserProfile: Creating new profile..."),t=await (0,o.xv)({id:e.id,email:e.email||"",user_metadata:e.user_metadata||{}}),console.log("useUserProfile: New profile created:",t),c(!0)),r(t)}catch(e){console.error("Error loading user profile:",e)}finally{s(!1)}})()},[e]),{profile:t,loading:a,needsSetup:l,setNeedsSetup:c,refreshProfile:async()=>{if(e)try{let t=await (0,o.et)(e.id);r(t)}catch(e){console.error("Error refreshing profile:",e)}}}}},6976:function(e,t,r){"use strict";r.d(t,{E1:function(){return a},LL:function(){return i}});let n={enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4},i={enableHighAccuracy:!0,timeout:5e3,maximumAge:5e3};class o{isSupported(){return"geolocation"in navigator}isOrientationSupported(){return"DeviceOrientationEvent"in window}async requestPermission(){if(console.log("LocationService: Requesting location permission"),!this.isSupported())return{granted:!1,denied:!0,prompt:!1,error:"Geolocation is not supported by this browser"};try{if("permissions"in navigator){let e=await navigator.permissions.query({name:"geolocation"});if(console.log("LocationService: Current permission state:",e.state),"granted"===e.state)return{granted:!0,denied:!1,prompt:!1};if("denied"===e.state)return{granted:!1,denied:!0,prompt:!1,error:"Location permission denied. Please enable location access in your browser settings."}}return new Promise(e=>{navigator.geolocation.getCurrentPosition(t=>{console.log("LocationService: Permission granted",t),e({granted:!0,denied:!1,prompt:!1})},t=>{console.error("LocationService: Permission denied or error:",t);let r="Location access denied";switch(t.code){case t.PERMISSION_DENIED:r="Location permission denied. Please enable location access in your browser settings.";break;case t.POSITION_UNAVAILABLE:r="Location information unavailable. Please check your GPS settings.";break;case t.TIMEOUT:r="Location request timed out. Please try again."}e({granted:!1,denied:!0,prompt:!1,error:r})},n)})}catch(e){return console.error("LocationService: Error requesting permission:",e),{granted:!1,denied:!0,prompt:!1,error:"Failed to request location permission"}}}async getCurrentLocation(){if(console.log("LocationService: Getting current location"),!this.isSupported())throw Error("Geolocation is not supported");return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(t=>{let r={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy};console.log("LocationService: Got current location:",r),this.lastKnownLocation=r,e(r)},e=>{console.error("LocationService: Error getting location:",e),t(Error("Location error: ".concat(e.message)))},n)})}startWatching(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;if(console.log("LocationService: Starting location watch"),!this.isSupported()){null==t||t("Geolocation is not supported");return}if(this.isWatching){console.log("LocationService: Already watching location");return}this.watchId=navigator.geolocation.watchPosition(t=>{let r={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy};console.log("LocationService: Location updated:",r),this.lastKnownLocation=r,e(r)},e=>{console.error("LocationService: Watch error:",e),null==t||t(e.message)},r),this.isWatching=!0,console.log("LocationService: Started watching with ID:",this.watchId)}stopWatching(){console.log("LocationService: Stopping location watch"),null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.isWatching=!1,console.log("LocationService: Stopped watching location")}async getDeviceHeading(){if(!this.isOrientationSupported())return console.log("LocationService: Device orientation not supported"),null;if("function"==typeof DeviceOrientationEvent.requestPermission)try{let e=await DeviceOrientationEvent.requestPermission();if("granted"!==e)return console.log("LocationService: Device orientation permission denied"),null}catch(e){return console.error("LocationService: Error requesting orientation permission:",e),null}return new Promise(e=>{let t=r=>{window.removeEventListener("deviceorientation",t);let n=r.alpha;console.log("LocationService: Device heading:",n),e(n)};window.addEventListener("deviceorientation",t),setTimeout(()=>{window.removeEventListener("deviceorientation",t),e(null)},5e3)})}calculateDistance(e,t){let r=e.latitude*Math.PI/180,n=t.latitude*Math.PI/180,i=(t.latitude-e.latitude)*Math.PI/180,o=(t.longitude-e.longitude)*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(n)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371e3}calculateBearing(e,t){let r=e.latitude*Math.PI/180,n=t.latitude*Math.PI/180,i=(t.longitude-e.longitude)*Math.PI/180;return(180*Math.atan2(Math.sin(i)*Math.cos(n),Math.cos(r)*Math.sin(n)-Math.sin(r)*Math.cos(n)*Math.cos(i))/Math.PI+360)%360}getLastKnownLocation(){return this.lastKnownLocation}getIsWatching(){return this.isWatching}constructor(){this.watchId=null,this.lastKnownLocation=null,this.isWatching=!1}}let a=new o},5347:function(e,t,r){"use strict";r.d(t,{Lj:function(){return a},et:function(){return o},ow:function(){return s},sx:function(){return c},xv:function(){return i}});var n=r(6881);async function i(e){var t;let r=e.user_metadata.full_name||e.user_metadata.name||(null===(t=e.email)||void 0===t?void 0:t.split("@")[0])||"Anonymous User",i={uid:e.id,email:e.email,display_name:r,created_at:Date.now(),last_active:Date.now()},{error:o}=await n.O.from("user_profiles").upsert(i);if(o)throw o;return i}async function o(e){let{data:t,error:r}=await n.O.from("user_profiles").select("*").eq("uid",e).single();if(r&&"PGRST116"!==r.code)throw r;return t}async function a(e,t){console.log("updateUserProfile: Updating profile for uid:",e,"with updates:",t);let{error:r}=await n.O.from("user_profiles").update({...t,last_active:Date.now()}).eq("uid",e);if(r)throw console.error("updateUserProfile: Error updating profile:",r),r;console.log("updateUserProfile: Profile updated successfully")}async function s(e,t){console.log("uploadProfilePicture: Starting upload for user:",e),await d(e);let r=await l(t),i=t.name.split(".").pop(),o="".concat(e,".").concat(i);console.log("uploadProfilePicture: Uploading file:",o,"Size:",r.size);let{error:s}=await n.O.storage.from("profile-pictures").upload(o,r,{upsert:!0,contentType:r.type});if(s)throw console.error("uploadProfilePicture: Upload error:",s),s;let{data:c}=n.O.storage.from("profile-pictures").getPublicUrl(o);return console.log("uploadProfilePicture: Public URL:",c.publicUrl),await a(e,{profile_picture_url:c.publicUrl}),c.publicUrl}async function l(e){return e.size<1e5?e:new Promise(t=>{let r=new FileReader;r.readAsDataURL(e),r.onload=r=>{var n;let i=new Image;i.src=null===(n=r.target)||void 0===n?void 0:n.result,i.onload=()=>{let r=document.createElement("canvas"),n=r.getContext("2d"),o=i.width,a=i.height;o>a&&o>500?(a=500*a/o,o=500):a>500&&(o=500*o/a,a=500),r.width=o,r.height=a,n.drawImage(i,0,0,o,a),r.toBlob(r=>{t(new File([r],e.name,{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",.8)}}})}async function c(e){try{console.log("deleteProfilePicture: Removing profile picture for user:",e),await d(e),await a(e,{profile_picture_url:void 0}),console.log("deleteProfilePicture: Profile picture deleted successfully")}catch(e){throw console.error("Error deleting profile picture:",e),e}}async function d(e){try{var t;console.log("deleteExistingProfilePictures: Cleaning up old pictures for user:",e);let{data:r,error:i}=await n.O.storage.from("profile-pictures").list("",{search:e});if(i){console.log("deleteExistingProfilePictures: Could not list files:",i);let{error:t}=await n.O.storage.from("profile-pictures").remove(["".concat(e,".jpg"),"".concat(e,".jpeg"),"".concat(e,".png"),"".concat(e,".gif"),"".concat(e,".webp"),"".concat(e,".bmp")]);t&&console.log("deleteExistingProfilePictures: Error removing files:",t);return}let o=(null==r?void 0:null===(t=r.filter(t=>t.name.startsWith(e)))||void 0===t?void 0:t.map(e=>e.name))||[];if(o.length>0){console.log("deleteExistingProfilePictures: Found files to delete:",o);let{error:e}=await n.O.storage.from("profile-pictures").remove(o);e?console.error("deleteExistingProfilePictures: Error removing files:",e):console.log("deleteExistingProfilePictures: Successfully deleted files:",o)}else console.log("deleteExistingProfilePictures: No existing files found for user")}catch(e){console.error("deleteExistingProfilePictures: Error:",e)}}},7818:function(e,t,r){"use strict";r.d(t,{default:function(){return i.a}});var n=r(551),i=r.n(n)},551:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let n=r(9920);r(7437),r(2265);let i=n._(r(148));function o(e,t){var r;let n={loading:e=>{let{error:t,isLoading:r,pastDelay:n}=e;return null}};"function"==typeof e&&(n.loader=e);let o={...n,...t};return(0,i.default)({...o,modules:null==(r=o.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return i}});let n=r(5592);function i(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return r}},148:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let n=r(7437),i=r(2265),o=r(912),a=r(1481);function s(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},r=(0,i.lazy)(()=>t.loader().then(s)),c=t.loading;function d(e){let s=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(a.PreloadCss,{moduleIds:t.modules}):null,(0,n.jsx)(r,{...e})]}):(0,n.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(r,{...e})});return(0,n.jsx)(i.Suspense,{fallback:s,children:l})}return d.displayName="LoadableComponent",d}},1481:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return o}});let n=r(7437),i=r(8512);function o(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,i.getExpectedRequestStore)("next/dynamic css"),o=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));o.push(...t)}}return 0===o.length?null:(0,n.jsx)(n.Fragment,{children:o.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},966:function(){}}]);